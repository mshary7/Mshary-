<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>مشاري بزنس - منصة إدارة الأعمال</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;500;600;700&display=swap');
        
        * {
            font-family: 'Cairo', sans-serif;
        }
        
        .chat-bubble-sent {
            background: linear-gradient(135deg, #10B981, #059669);
            color: white;
            border-radius: 18px 18px 4px 18px;
        }
        
        .chat-bubble-received {
            background: #f3f4f6;
            color: #1f2937;
            border-radius: 18px 18px 18px 4px;
        }
        
        .typing-indicator {
            animation: pulse 1.5s ease-in-out infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 0.4; }
            50% { opacity: 1; }
        }
        
        .sidebar-transition {
            transition: transform 0.3s ease-in-out;
        }
        
        .dark {
            --bg-primary: #1f2937;
            --bg-secondary: #374151;
            --text-primary: #f9fafb;
            --text-secondary: #d1d5db;
        }
        
        .dark .bg-white { background-color: var(--bg-primary) !important; }
        .dark .bg-gray-50 { background-color: var(--bg-secondary) !important; }
        .dark .text-gray-900 { color: var(--text-primary) !important; }
        .dark .text-gray-600 { color: var(--text-secondary) !important; }
        .dark .border-gray-200 { border-color: #4b5563 !important; }
    </style>
</head>
<body class="bg-gray-100 h-screen overflow-hidden">
    <!-- شاشة الترحيب -->
    <div id="onboarding" class="fixed inset-0 bg-gradient-to-br from-emerald-500 to-emerald-700 flex items-center justify-center z-50">
        <div class="bg-white rounded-2xl p-8 max-w-md w-full mx-4 text-center shadow-2xl">
            <div class="w-20 h-20 bg-emerald-500 rounded-full flex items-center justify-center mx-auto mb-6">
                <span class="text-white text-2xl font-bold">م</span>
            </div>
            <h1 class="text-2xl font-bold text-gray-900 mb-2">مرحباً بك في مشاري بزنس</h1>
            <p class="text-gray-600 mb-6">منصة إدارة الأعمال الذكية</p>
            
            <div class="space-y-4">
                <input type="text" id="businessName" placeholder="اسم نشاطك التجاري" 
                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-transparent">
                
                <select id="currency" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500">
                    <option value="SAR">ريال سعودي (SAR)</option>
                    <option value="AED">درهم إماراتي (AED)</option>
                    <option value="USD">دولار أمريكي (USD)</option>
                </select>
                
                <button onclick="startApp()" class="w-full bg-emerald-500 text-white py-3 rounded-lg font-semibold hover:bg-emerald-600 transition-colors">
                    ابدأ الآن
                </button>
            </div>
        </div>
    </div>

    <!-- الواجهة الرئيسية -->
    <div id="mainApp" class="hidden h-full flex flex-col">
        <!-- الشريط العلوي -->
        <header class="bg-white border-b border-gray-200 px-4 py-3 flex items-center justify-between">
            <div class="flex items-center space-x-3 space-x-reverse">
                <!-- زر القائمة للجوال -->
                <button onclick="toggleMobileMenu()" class="md:hidden p-2 text-gray-600 hover:bg-gray-100 rounded-lg">
                    ☰
                </button>
                
                <div class="w-8 h-8 md:w-10 md:h-10 bg-emerald-500 rounded-full flex items-center justify-center">
                    <span class="text-white font-bold text-sm md:text-base">م</span>
                </div>
                <div class="hidden sm:block">
                    <h1 class="font-semibold text-gray-900 text-sm md:text-base" id="businessTitle">مشاري بزنس</h1>
                    <p class="text-xs md:text-sm text-emerald-600">متصل الآن</p>
                </div>
            </div>
            
            <div class="flex items-center space-x-2 space-x-reverse">
                <button onclick="showSubscription()" class="p-2 text-gray-600 hover:bg-gray-100 rounded-lg relative">
                    <span class="text-sm md:text-base">💎</span>
                    <span class="absolute -top-1 -right-1 bg-emerald-500 text-white text-xs rounded-full w-4 h-4 flex items-center justify-center">!</span>
                </button>
                <button onclick="showSettings()" class="p-2 text-gray-600 hover:bg-gray-100 rounded-lg">
                    <span class="text-sm md:text-base">⚙️</span>
                </button>
                <button onclick="toggleTheme()" class="p-2 text-gray-600 hover:bg-gray-100 rounded-lg">
                    <span id="themeIcon" class="text-sm md:text-base">🌙</span>
                </button>
                <button onclick="showDashboard()" class="p-2 text-gray-600 hover:bg-gray-100 rounded-lg">
                    <span class="text-sm md:text-base">📊</span>
                </button>
                <button onclick="toggleToolsPanel()" class="md:hidden p-2 text-gray-600 hover:bg-gray-100 rounded-lg">
                    <span class="text-sm">🛠️</span>
                </button>
            </div>
        </header>

        <!-- المحتوى الرئيسي -->
        <div class="flex-1 flex overflow-hidden relative">
            <!-- قائمة المحادثات -->
            <div id="chatsList" class="w-full md:w-80 bg-white border-l border-gray-200 flex flex-col absolute md:relative z-20 transform -translate-x-full md:translate-x-0 transition-transform duration-300">
                <div class="p-3 md:p-4 border-b border-gray-200 flex items-center justify-between">
                    <h2 class="font-semibold text-gray-900 text-sm md:text-base">المحادثات</h2>
                    <button onclick="toggleMobileMenu()" class="md:hidden p-1 text-gray-600 hover:bg-gray-100 rounded">
                        ✕
                    </button>
                </div>
                
                <div class="flex-1 overflow-y-auto" id="chatsList-content">
                    <!-- سيتم ملؤها ديناميكياً من قاعدة البيانات -->
                </div>
            </div>

            <!-- نافذة المحادثة -->
            <div class="flex-1 flex flex-col bg-gray-50">
                <!-- رأس المحادثة -->
                <div class="bg-white border-b border-gray-200 p-3 md:p-4 flex items-center justify-between">
                    <div class="flex items-center space-x-3 space-x-reverse">
                        <button onclick="toggleMobileMenu()" class="md:hidden p-1 text-gray-600 hover:bg-gray-100 rounded">
                            ←
                        </button>
                        <div class="w-8 h-8 md:w-10 md:h-10 bg-blue-500 rounded-full flex items-center justify-center text-white font-semibold text-sm md:text-base">
                            ع
                        </div>
                        <div class="min-w-0 flex-1">
                            <h3 class="font-semibold text-gray-900 text-sm md:text-base truncate" id="currentChatName">عميل محمد</h3>
                            <p class="text-xs md:text-sm text-gray-600" id="chatStatus">متصل الآن</p>
                        </div>
                    </div>
                    
                    <button onclick="toggleToolsPanel()" class="bg-emerald-500 text-white px-2 py-1 md:px-4 md:py-2 rounded-lg hover:bg-emerald-600 transition-colors text-xs md:text-sm">
                        <span class="hidden md:inline">أدوات الأعمال</span>
                        <span class="md:hidden">🛠️</span>
                    </button>
                </div>

                <!-- منطقة الرسائل -->
                <div class="flex-1 overflow-y-auto p-3 md:p-4 space-y-3 md:space-y-4" id="messagesArea">
                    <div class="flex justify-start">
                        <div class="chat-bubble-received max-w-xs md:max-w-sm px-3 py-2 md:px-4 md:py-2">
                            <p class="text-sm md:text-base">مرحباً، أريد عرض سعر للمنتج الجديد</p>
                            <p class="text-xs text-gray-500 mt-1">10:25</p>
                        </div>
                    </div>
                    
                    <div class="flex justify-end">
                        <div class="chat-bubble-sent max-w-xs md:max-w-sm px-3 py-2 md:px-4 md:py-2">
                            <p class="text-sm md:text-base">أهلاً وسهلاً! سأرسل لك عرض السعر خلال دقائق</p>
                            <p class="text-xs text-white/70 mt-1">10:26 ✓✓</p>
                        </div>
                    </div>
                    
                    <div class="flex justify-start">
                        <div class="chat-bubble-received max-w-xs md:max-w-sm px-3 py-2 md:px-4 md:py-2">
                            <p class="text-sm md:text-base">ممتاز، في انتظارك</p>
                            <p class="text-xs text-gray-500 mt-1">10:27</p>
                        </div>
                    </div>
                    
                    <div id="typingIndicator" class="flex justify-start hidden">
                        <div class="chat-bubble-received max-w-xs md:max-w-sm px-3 py-2 md:px-4 md:py-2 typing-indicator">
                            <p class="text-sm md:text-base">يكتب الآن...</p>
                        </div>
                    </div>
                </div>

                <!-- منطقة كتابة الرسالة -->
                <div class="bg-white border-t border-gray-200 p-3 md:p-4">
                    <div class="flex items-center space-x-2 md:space-x-3 space-x-reverse">
                        <button class="p-2 text-gray-600 hover:bg-gray-100 rounded-lg flex-shrink-0">
                            <span class="text-sm md:text-base">📎</span>
                        </button>
                        <input type="text" id="messageInput" placeholder="اكتب رسالتك هنا..." 
                               class="flex-1 px-3 py-2 md:px-4 md:py-2 border border-gray-300 rounded-full focus:ring-2 focus:ring-emerald-500 focus:border-transparent text-sm md:text-base"
                               onkeypress="handleEnter(event)">
                        <button onclick="sendMessage()" class="bg-emerald-500 text-white p-2 rounded-full hover:bg-emerald-600 transition-colors flex-shrink-0">
                            <span class="text-sm md:text-base">➤</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- لوحة الأدوات -->
            <div id="toolsPanel" class="fixed md:relative inset-0 md:inset-auto w-full md:w-96 bg-white border-l border-gray-200 sidebar-transition transform translate-x-full z-30">
                <div class="p-3 md:p-4 border-b border-gray-200 flex items-center justify-between">
                    <h2 class="font-semibold text-gray-900 text-sm md:text-base">أدوات الأعمال</h2>
                    <button onclick="toggleToolsPanel()" class="text-gray-600 hover:bg-gray-100 p-1 rounded">
                        ✕
                    </button>
                </div>
                
                <!-- تبويبات الأدوات -->
                <div class="border-b border-gray-200">
                    <nav class="flex space-x-1 space-x-reverse p-2 overflow-x-auto">
                        <button onclick="showTool('calculator')" class="tool-tab px-2 py-2 md:px-3 md:py-2 text-xs md:text-sm font-medium rounded-lg bg-emerald-100 text-emerald-700 whitespace-nowrap">
                            حاسبة
                        </button>
                        <button onclick="showTool('templates')" class="tool-tab px-2 py-2 md:px-3 md:py-2 text-xs md:text-sm font-medium rounded-lg text-gray-600 hover:bg-gray-100 whitespace-nowrap">
                            قوالب
                        </button>
                        <button onclick="showTool('ai')" class="tool-tab px-2 py-2 md:px-3 md:py-2 text-xs md:text-sm font-medium rounded-lg text-gray-600 hover:bg-gray-100 whitespace-nowrap">
                            مساعد ذكي
                        </button>
                        <button onclick="showTool('catalog')" class="tool-tab px-2 py-2 md:px-3 md:py-2 text-xs md:text-sm font-medium rounded-lg text-gray-600 hover:bg-gray-100 whitespace-nowrap">
                            كتالوج
                        </button>
                        <button onclick="showTool('pdf')" class="tool-tab px-2 py-2 md:px-3 md:py-2 text-xs md:text-sm font-medium rounded-lg text-gray-600 hover:bg-gray-100 whitespace-nowrap">
                            PDF
                        </button>
                        <button onclick="showTool('reports')" class="tool-tab px-2 py-2 md:px-3 md:py-2 text-xs md:text-sm font-medium rounded-lg text-gray-600 hover:bg-gray-100 whitespace-nowrap">
                            تقارير
                        </button>
                        <button onclick="showTool('schedule')" class="tool-tab px-2 py-2 md:px-3 md:py-2 text-xs md:text-sm font-medium rounded-lg text-gray-600 hover:bg-gray-100 whitespace-nowrap">
                            جدولة
                        </button>
                    </nav>
                </div>

                <!-- محتوى الأدوات -->
                <div class="flex-1 overflow-y-auto p-3 md:p-4 h-full">
                    <!-- آلة حاسبة الأرباح المتقدمة -->
                    <div id="calculator-tool" class="tool-content">
                        <h3 class="font-semibold text-gray-900 mb-3 md:mb-4 text-sm md:text-base">حاسبة الأرباح المتقدمة</h3>
                        
                        <div class="space-y-3 md:space-y-4">
                            <div>
                                <label class="block text-xs md:text-sm font-medium text-gray-700 mb-1">المبيعات</label>
                                <input type="number" id="sales" placeholder="0" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 text-sm md:text-base">
                            </div>
                            
                            <div>
                                <label class="block text-xs md:text-sm font-medium text-gray-700 mb-1">التكاليف المباشرة</label>
                                <input type="number" id="costs" placeholder="0" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 text-sm md:text-base">
                            </div>
                            
                            <div>
                                <label class="block text-xs md:text-sm font-medium text-gray-700 mb-1">التكاليف التشغيلية</label>
                                <input type="number" id="operatingCosts" placeholder="0" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 text-sm md:text-base">
                            </div>
                            
                            <div>
                                <label class="block text-xs md:text-sm font-medium text-gray-700 mb-1">الضرائب والرسوم (%)</label>
                                <input type="number" id="taxes" placeholder="15" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 text-sm md:text-base">
                            </div>
                            
                            <button onclick="calculateProfit()" class="w-full bg-emerald-500 text-white py-2 md:py-3 rounded-lg hover:bg-emerald-600 transition-colors text-sm md:text-base font-medium">
                                احسب الربح
                            </button>
                            
                            <div id="profitResults" class="hidden bg-gray-50 p-3 md:p-4 rounded-lg">
                                <div class="space-y-2">
                                    <div class="flex justify-between items-center">
                                        <span class="text-gray-600 text-xs md:text-sm">الربح الإجمالي:</span>
                                        <span class="font-semibold text-xs md:text-sm" id="grossProfit">0 ريال</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-gray-600 text-xs md:text-sm">الربح التشغيلي:</span>
                                        <span class="font-semibold text-xs md:text-sm" id="operatingProfit">0 ريال</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-gray-600 text-xs md:text-sm">الربح الصافي:</span>
                                        <span class="font-semibold text-emerald-600 text-xs md:text-sm" id="netProfit">0 ريال</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-gray-600 text-xs md:text-sm">هامش الربح:</span>
                                        <span class="font-semibold text-xs md:text-sm" id="profitMargin">0%</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-gray-600 text-xs md:text-sm">العائد على الاستثمار:</span>
                                        <span class="font-semibold text-xs md:text-sm" id="roi">0%</span>
                                    </div>
                                </div>
                                
                                <button onclick="sendProfitSummary()" class="w-full mt-3 bg-blue-500 text-white py-2 rounded-lg hover:bg-blue-600 transition-colors text-xs md:text-sm">
                                    إرسال الملخص في المحادثة
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- قوالب الرسائل -->
                    <div id="templates-tool" class="tool-content hidden">
                        <h3 class="font-semibold text-gray-900 mb-4">قوالب الرسائل</h3>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">فئة القالب</label>
                                <select id="templateCategory" onchange="filterTemplates()" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500">
                                    <option value="">جميع الفئات</option>
                                    <option value="ترحيب">ترحيب</option>
                                    <option value="عروض">عروض الأسعار</option>
                                    <option value="طلبات">الطلبات</option>
                                    <option value="متابعة">المتابعة</option>
                                    <option value="تسويق">التسويق</option>
                                    <option value="دعم">الدعم الفني</option>
                                </select>
                            </div>
                            
                            <div id="templatesList" class="space-y-2 max-h-64 overflow-y-auto">
                                <!-- سيتم ملؤها ديناميكياً -->
                            </div>
                            
                            <div class="border-t pt-4">
                                <h4 class="font-medium text-gray-700 mb-2">معاينة القالب</h4>
                                <div id="templatePreview" class="bg-gray-50 p-3 rounded-lg text-sm text-gray-600 min-h-20">
                                    اختر قالباً لمعاينته
                                </div>
                                
                                <button id="useTemplateBtn" onclick="useTemplate()" class="w-full mt-3 bg-emerald-500 text-white py-2 rounded-lg hover:bg-emerald-600 transition-colors disabled:bg-gray-300" disabled>
                                    استخدام القالب
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- المساعد الذكي -->
                    <div id="ai-tool" class="tool-content hidden">
                        <h3 class="font-semibold text-gray-900 mb-4">المساعد الذكي</h3>
                        
                        <div class="space-y-4">
                            <!-- اقتراحات الردود -->
                            <div class="bg-blue-50 p-4 rounded-lg">
                                <h4 class="font-medium text-blue-900 mb-2">🤖 اقتراحات ذكية</h4>
                                <div id="aiSuggestions" class="space-y-2">
                                    <!-- سيتم ملؤها ديناميكياً -->
                                </div>
                            </div>
                            
                            <!-- تحليل المحادثة -->
                            <div class="bg-green-50 p-4 rounded-lg">
                                <h4 class="font-medium text-green-900 mb-2">📊 تحليل المحادثة</h4>
                                <div class="space-y-2 text-sm">
                                    <div class="flex justify-between">
                                        <span>مزاج العميل:</span>
                                        <span class="font-medium text-green-600">إيجابي 😊</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span>احتمالية الشراء:</span>
                                        <span class="font-medium text-green-600">عالية (85%)</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span>نوع العميل:</span>
                                        <span class="font-medium">VIP</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- رؤى ذكية -->
                            <div class="bg-yellow-50 p-4 rounded-lg">
                                <h4 class="font-medium text-yellow-900 mb-2">💡 رؤى ذكية</h4>
                                <div id="aiInsights" class="space-y-2 text-sm">
                                    <!-- سيتم ملؤها ديناميكياً -->
                                </div>
                            </div>
                            
                            <!-- إعدادات المساعد -->
                            <div class="border-t pt-4">
                                <div class="flex items-center justify-between mb-2">
                                    <span class="text-sm font-medium">تفعيل الاقتراحات التلقائية</span>
                                    <button onclick="toggleAI()" class="relative inline-flex h-6 w-11 items-center rounded-full bg-emerald-500 transition-colors" id="aiToggle">
                                        <span class="inline-block h-4 w-4 transform rounded-full bg-white transition-transform translate-x-6" id="aiSlider"></span>
                                    </button>
                                </div>
                                <p class="text-xs text-gray-600">سيقترح المساعد ردود تلقائية بناءً على سياق المحادثة</p>
                            </div>
                        </div>
                    </div>

                    <!-- كتالوج المنتجات -->
                    <div id="catalog-tool" class="tool-content hidden">
                        <h3 class="font-semibold text-gray-900 mb-4">كتالوج المنتجات</h3>
                        
                        <div class="space-y-4">
                            <div class="flex space-x-2 space-x-reverse">
                                <input type="text" id="productSearch" placeholder="البحث في المنتجات..." 
                                       class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 text-sm"
                                       onkeyup="searchProducts()">
                                <select id="categoryFilter" onchange="filterProducts()" class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 text-sm">
                                    <option value="">جميع الفئات</option>
                                    <option value="إلكترونيات">إلكترونيات</option>
                                    <option value="إكسسوارات">إكسسوارات</option>
                                    <option value="تصوير">تصوير</option>
                                    <option value="منزل ذكي">منزل ذكي</option>
                                    <option value="ألعاب">ألعاب</option>
                                    <option value="صحة">صحة</option>
                                </select>
                            </div>
                            
                            <div id="productsList" class="space-y-2 max-h-80 overflow-y-auto">
                                <!-- سيتم ملؤها ديناميكياً -->
                            </div>
                            
                            <div class="border-t pt-4">
                                <h4 class="font-medium text-gray-700 mb-2">المنتجات المحددة</h4>
                                <div id="selectedProducts" class="space-y-2 mb-3">
                                    <p class="text-sm text-gray-500">لم يتم تحديد منتجات</p>
                                </div>
                                
                                <button id="sendProductsBtn" onclick="sendSelectedProducts()" class="w-full bg-emerald-500 text-white py-2 rounded-lg hover:bg-emerald-600 transition-colors disabled:bg-gray-300" disabled>
                                    إرسال المنتجات المحددة
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- تحويل PDF -->
                    <div id="pdf-tool" class="tool-content hidden">
                        <h3 class="font-semibold text-gray-900 mb-4">تحويل الصور إلى PDF</h3>
                        
                        <div class="space-y-4">
                            <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center">
                                <input type="file" id="imageInput" accept="image/*" multiple class="hidden" onchange="handleImageUpload(event)">
                                <button onclick="document.getElementById('imageInput').click()" class="text-emerald-600 hover:text-emerald-700">
                                    📷 اختر الصور
                                </button>
                                <p class="text-sm text-gray-500 mt-2">أو اسحب الصور هنا</p>
                            </div>
                            
                            <div id="imagePreview" class="hidden space-y-2">
                                <h4 class="font-medium text-gray-700">الصور المحددة:</h4>
                                <div id="imageList" class="space-y-2"></div>
                                
                                <button onclick="convertToPDF()" class="w-full bg-emerald-500 text-white py-2 rounded-lg hover:bg-emerald-600 transition-colors">
                                    تحويل إلى PDF
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- التقارير -->
                    <div id="reports-tool" class="tool-content hidden">
                        <h3 class="font-semibold text-gray-900 mb-4">التقارير الذكية</h3>
                        
                        <div class="space-y-4">
                            <div class="grid grid-cols-2 gap-4">
                                <div class="bg-emerald-50 p-4 rounded-lg text-center">
                                    <p class="text-2xl font-bold text-emerald-600">127</p>
                                    <p class="text-sm text-gray-600">إجمالي الطلبات</p>
                                </div>
                                <div class="bg-blue-50 p-4 rounded-lg text-center">
                                    <p class="text-2xl font-bold text-blue-600">45,230</p>
                                    <p class="text-sm text-gray-600">إجمالي المبيعات</p>
                                </div>
                            </div>
                            
                            <div class="bg-gray-50 p-4 rounded-lg">
                                <h4 class="font-medium text-gray-700 mb-2">أداء هذا الشهر</h4>
                                <div class="h-32 bg-white rounded flex items-center justify-center">
                                    <canvas id="salesChart" width="300" height="120"></canvas>
                                </div>
                            </div>
                            
                            <button onclick="generateReport()" class="w-full bg-emerald-500 text-white py-2 rounded-lg hover:bg-emerald-600 transition-colors">
                                تصدير التقرير
                            </button>
                        </div>
                    </div>

                    <!-- جدولة الرسائل -->
                    <div id="schedule-tool" class="tool-content hidden">
                        <h3 class="font-semibold text-gray-900 mb-4">جدولة الرسائل</h3>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">نص الرسالة</label>
                                <textarea id="scheduledMessage" rows="3" placeholder="اكتب رسالتك هنا..." 
                                         class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500"></textarea>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">التاريخ والوقت</label>
                                <input type="datetime-local" id="scheduleDateTime" 
                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">التكرار</label>
                                <select id="scheduleRepeat" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500">
                                    <option value="none">بدون تكرار</option>
                                    <option value="daily">يومياً</option>
                                    <option value="weekly">أسبوعياً</option>
                                    <option value="monthly">شهرياً</option>
                                </select>
                            </div>
                            
                            <button onclick="scheduleMessage()" class="w-full bg-emerald-500 text-white py-2 rounded-lg hover:bg-emerald-600 transition-colors">
                                جدولة الرسالة
                            </button>
                            
                            <div id="scheduledList" class="space-y-2">
                                <h4 class="font-medium text-gray-700">الرسائل المجدولة:</h4>
                                <div class="text-sm text-gray-500">لا توجد رسائل مجدولة</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- نافذة الإعدادات -->
    <div id="settings" class="hidden fixed inset-0 bg-white z-40">
        <div class="h-full flex flex-col">
            <header class="bg-white border-b border-gray-200 px-4 md:px-6 py-3 md:py-4 flex items-center justify-between">
                <h1 class="text-lg md:text-2xl font-bold text-gray-900">الإعدادات</h1>
                <button onclick="hideSettings()" class="text-gray-600 hover:bg-gray-100 p-2 rounded-lg">
                    ✕
                </button>
            </header>
            
            <div class="flex-1 overflow-y-auto">
                <div class="max-w-4xl mx-auto p-4 md:p-6">
                    <!-- تبويبات الإعدادات -->
                    <div class="border-b border-gray-200 mb-6">
                        <nav class="flex space-x-1 space-x-reverse overflow-x-auto">
                            <button onclick="showSettingsTab('general')" class="settings-tab px-4 py-2 text-sm font-medium rounded-t-lg bg-emerald-100 text-emerald-700 border-b-2 border-emerald-500 whitespace-nowrap">
                                عام
                            </button>
                            <button onclick="showSettingsTab('business')" class="settings-tab px-4 py-2 text-sm font-medium rounded-t-lg text-gray-600 hover:bg-gray-100 whitespace-nowrap">
                                معلومات النشاط
                            </button>
                            <button onclick="showSettingsTab('notifications')" class="settings-tab px-4 py-2 text-sm font-medium rounded-t-lg text-gray-600 hover:bg-gray-100 whitespace-nowrap">
                                الإشعارات
                            </button>
                            <button onclick="showSettingsTab('automation')" class="settings-tab px-4 py-2 text-sm font-medium rounded-t-lg text-gray-600 hover:bg-gray-100 whitespace-nowrap">
                                الأتمتة
                            </button>
                            <button onclick="showSettingsTab('export')" class="settings-tab px-4 py-2 text-sm font-medium rounded-t-lg text-gray-600 hover:bg-gray-100 whitespace-nowrap">
                                التصدير
                            </button>
                        </nav>
                    </div>
                    
                    <!-- الإعدادات العامة -->
                    <div id="general-settings" class="settings-content">
                        <div class="bg-white rounded-xl border border-gray-200 p-6">
                            <h3 class="text-lg font-semibold text-gray-900 mb-4">الإعدادات العامة</h3>
                            
                            <div class="space-y-6">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">اللغة</label>
                                    <select id="languageSelect" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500">
                                        <option value="ar">العربية</option>
                                        <option value="en">English</option>
                                    </select>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">العملة</label>
                                    <select id="currencySelect" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500">
                                        <option value="SAR">ريال سعودي (SAR)</option>
                                        <option value="AED">درهم إماراتي (AED)</option>
                                        <option value="USD">دولار أمريكي (USD)</option>
                                        <option value="EUR">يورو (EUR)</option>
                                    </select>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">المنطقة الزمنية</label>
                                    <select class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500">
                                        <option value="Asia/Riyadh">الرياض (GMT+3)</option>
                                        <option value="Asia/Dubai">دبي (GMT+4)</option>
                                        <option value="UTC">UTC (GMT+0)</option>
                                    </select>
                                </div>
                                
                                <div class="flex items-center justify-between">
                                    <div>
                                        <h4 class="text-sm font-medium text-gray-900">الوضع المظلم</h4>
                                        <p class="text-sm text-gray-600">تفعيل الوضع المظلم للواجهة</p>
                                    </div>
                                    <button onclick="toggleTheme()" class="relative inline-flex h-6 w-11 items-center rounded-full bg-gray-200 transition-colors focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-2" id="darkModeToggle">
                                        <span class="inline-block h-4 w-4 transform rounded-full bg-white transition-transform translate-x-1" id="darkModeSlider"></span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- معلومات النشاط التجاري -->
                    <div id="business-settings" class="settings-content hidden">
                        <div class="bg-white rounded-xl border border-gray-200 p-6">
                            <h3 class="text-lg font-semibold text-gray-900 mb-4">معلومات النشاط التجاري</h3>
                            
                            <div class="space-y-6">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">اسم النشاط</label>
                                    <input type="text" id="businessNameInput" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500">
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">وصف النشاط</label>
                                    <textarea rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500" placeholder="اكتب وصفاً مختصراً عن نشاطك التجاري"></textarea>
                                </div>
                                
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">رقم الهاتف</label>
                                        <input type="tel" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500" placeholder="+966 50 123 4567">
                                    </div>
                                    
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">البريد الإلكتروني</label>
                                        <input type="email" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500" placeholder="info@business.com">
                                    </div>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">العنوان</label>
                                    <input type="text" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500" placeholder="الرياض، المملكة العربية السعودية">
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">ساعات العمل</label>
                                    <div class="grid grid-cols-2 gap-4">
                                        <input type="time" class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500" value="09:00">
                                        <input type="time" class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500" value="18:00">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- إعدادات الإشعارات -->
                    <div id="notifications-settings" class="settings-content hidden">
                        <div class="bg-white rounded-xl border border-gray-200 p-6">
                            <h3 class="text-lg font-semibold text-gray-900 mb-4">إعدادات الإشعارات</h3>
                            
                            <div class="space-y-6">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <h4 class="text-sm font-medium text-gray-900">إشعارات الرسائل الجديدة</h4>
                                        <p class="text-sm text-gray-600">تلقي إشعار عند وصول رسالة جديدة</p>
                                    </div>
                                    <button onclick="toggleNotifications()" class="relative inline-flex h-6 w-11 items-center rounded-full bg-emerald-500 transition-colors focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-2" id="notificationsToggle">
                                        <span class="inline-block h-4 w-4 transform rounded-full bg-white transition-transform translate-x-6" id="notificationsSlider"></span>
                                    </button>
                                </div>
                                
                                <div class="flex items-center justify-between">
                                    <div>
                                        <h4 class="text-sm font-medium text-gray-900">إشعارات الطلبات</h4>
                                        <p class="text-sm text-gray-600">تلقي إشعار عند وصول طلب جديد</p>
                                    </div>
                                    <button class="relative inline-flex h-6 w-11 items-center rounded-full bg-emerald-500 transition-colors focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-2">
                                        <span class="inline-block h-4 w-4 transform rounded-full bg-white transition-transform translate-x-6"></span>
                                    </button>
                                </div>
                                
                                <div class="flex items-center justify-between">
                                    <div>
                                        <h4 class="text-sm font-medium text-gray-900">إشعارات التقارير</h4>
                                        <p class="text-sm text-gray-600">تلقي تقرير يومي عن الأداء</p>
                                    </div>
                                    <button class="relative inline-flex h-6 w-11 items-center rounded-full bg-gray-200 transition-colors focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-2">
                                        <span class="inline-block h-4 w-4 transform rounded-full bg-white transition-transform translate-x-1"></span>
                                    </button>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">نغمة الإشعار</label>
                                    <select class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500">
                                        <option>النغمة الافتراضية</option>
                                        <option>نغمة هادئة</option>
                                        <option>نغمة قوية</option>
                                        <option>بدون صوت</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- إعدادات الأتمتة -->
                    <div id="automation-settings" class="settings-content hidden">
                        <div class="bg-white rounded-xl border border-gray-200 p-6">
                            <h3 class="text-lg font-semibold text-gray-900 mb-4">إعدادات الأتمتة</h3>
                            
                            <div class="space-y-6">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <h4 class="text-sm font-medium text-gray-900">الرد التلقائي</h4>
                                        <p class="text-sm text-gray-600">إرسال رد تلقائي للرسائل الجديدة</p>
                                    </div>
                                    <button onclick="toggleAutoReply()" class="relative inline-flex h-6 w-11 items-center rounded-full bg-gray-200 transition-colors focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-2" id="autoReplyToggle">
                                        <span class="inline-block h-4 w-4 transform rounded-full bg-white transition-transform translate-x-1" id="autoReplySlider"></span>
                                    </button>
                                </div>
                                
                                <div id="autoReplySettings" class="hidden">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">نص الرد التلقائي</label>
                                    <textarea rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500" placeholder="شكراً لتواصلك معنا! سنرد عليك في أقرب وقت ممكن."></textarea>
                                </div>
                                
                                <div class="border-t pt-6">
                                    <h4 class="text-sm font-medium text-gray-900 mb-4">الرسائل المجدولة</h4>
                                    
                                    <div class="space-y-4">
                                        <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                                            <div>
                                                <p class="font-medium text-gray-900">رسالة ترحيب للعملاء الجدد</p>
                                                <p class="text-sm text-gray-600">ترسل تلقائياً عند أول تفاعل</p>
                                            </div>
                                            <button class="text-emerald-600 hover:text-emerald-700 text-sm font-medium">تعديل</button>
                                        </div>
                                        
                                        <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                                            <div>
                                                <p class="font-medium text-gray-900">تذكير متابعة الطلب</p>
                                                <p class="text-sm text-gray-600">ترسل بعد 24 ساعة من الطلب</p>
                                            </div>
                                            <button class="text-emerald-600 hover:text-emerald-700 text-sm font-medium">تعديل</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- إعدادات التصدير -->
                    <div id="export-settings" class="settings-content hidden">
                        <div class="bg-white rounded-xl border border-gray-200 p-6">
                            <h3 class="text-lg font-semibold text-gray-900 mb-4">تصدير البيانات</h3>
                            
                            <div class="space-y-6">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div class="border border-gray-200 rounded-lg p-4">
                                        <h4 class="font-medium text-gray-900 mb-2">تصدير المحادثات</h4>
                                        <p class="text-sm text-gray-600 mb-4">تصدير جميع المحادثات مع العملاء</p>
                                        <button onclick="exportChats()" class="w-full bg-emerald-500 text-white py-2 rounded-lg hover:bg-emerald-600 transition-colors">
                                            تصدير المحادثات
                                        </button>
                                    </div>
                                    
                                    <div class="border border-gray-200 rounded-lg p-4">
                                        <h4 class="font-medium text-gray-900 mb-2">تصدير الطلبات</h4>
                                        <p class="text-sm text-gray-600 mb-4">تصدير جميع الطلبات والمبيعات</p>
                                        <button onclick="exportOrders()" class="w-full bg-emerald-500 text-white py-2 rounded-lg hover:bg-emerald-600 transition-colors">
                                            تصدير الطلبات
                                        </button>
                                    </div>
                                    
                                    <div class="border border-gray-200 rounded-lg p-4">
                                        <h4 class="font-medium text-gray-900 mb-2">تصدير العملاء</h4>
                                        <p class="text-sm text-gray-600 mb-4">تصدير قائمة العملاء ومعلوماتهم</p>
                                        <button onclick="exportCustomers()" class="w-full bg-emerald-500 text-white py-2 rounded-lg hover:bg-emerald-600 transition-colors">
                                            تصدير العملاء
                                        </button>
                                    </div>
                                    
                                    <div class="border border-gray-200 rounded-lg p-4">
                                        <h4 class="font-medium text-gray-900 mb-2">تصدير التقارير</h4>
                                        <p class="text-sm text-gray-600 mb-4">تصدير التقارير والإحصائيات</p>
                                        <button onclick="exportReports()" class="w-full bg-emerald-500 text-white py-2 rounded-lg hover:bg-emerald-600 transition-colors">
                                            تصدير التقارير
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="border-t pt-6">
                                    <h4 class="text-sm font-medium text-gray-900 mb-4">نسخ احتياطي كامل</h4>
                                    <p class="text-sm text-gray-600 mb-4">إنشاء نسخة احتياطية من جميع البيانات</p>
                                    <button onclick="createBackup()" class="bg-blue-500 text-white px-6 py-3 rounded-lg hover:bg-blue-600 transition-colors">
                                        إنشاء نسخة احتياطية
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- أزرار الحفظ -->
                    <div class="flex justify-end space-x-3 space-x-reverse mt-8">
                        <button onclick="hideSettings()" class="px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors">
                            إلغاء
                        </button>
                        <button onclick="saveSettings()" class="px-6 py-2 bg-emerald-500 text-white rounded-lg hover:bg-emerald-600 transition-colors">
                            حفظ الإعدادات
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- نافذة الاشتراكات والترقية -->
    <div id="subscription" class="hidden fixed inset-0 bg-white z-40">
        <div class="h-full flex flex-col">
            <header class="bg-white border-b border-gray-200 px-4 md:px-6 py-3 md:py-4 flex items-center justify-between">
                <h1 class="text-lg md:text-2xl font-bold text-gray-900">الاشتراكات والباقات</h1>
                <button onclick="hideSubscription()" class="text-gray-600 hover:bg-gray-100 p-2 rounded-lg">
                    ✕
                </button>
            </header>
            
            <div class="flex-1 overflow-y-auto p-4 md:p-6">
                <!-- حالة الاشتراك الحالي -->
                <div class="bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-xl p-6 mb-8">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="text-lg font-semibold text-blue-900">اشتراكك الحالي</h3>
                            <p class="text-blue-700">الباقة المجانية</p>
                            <p class="text-sm text-blue-600 mt-1">محدود بـ 100 محادثة شهرياً</p>
                        </div>
                        <div class="text-left">
                            <p class="text-2xl font-bold text-blue-900">مجاني</p>
                            <p class="text-sm text-blue-600">67 محادثة متبقية</p>
                        </div>
                    </div>
                    
                    <div class="mt-4 bg-blue-100 rounded-lg p-3">
                        <div class="flex justify-between text-sm text-blue-800 mb-1">
                            <span>الاستخدام الشهري</span>
                            <span>33/100</span>
                        </div>
                        <div class="w-full bg-blue-200 rounded-full h-2">
                            <div class="bg-blue-600 h-2 rounded-full" style="width: 33%"></div>
                        </div>
                    </div>
                </div>
                
                <!-- الباقات المتاحة -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <!-- الباقة المجانية -->
                    <div class="border border-gray-200 rounded-xl p-6 relative">
                        <div class="text-center mb-6">
                            <h3 class="text-xl font-bold text-gray-900">المجاني</h3>
                            <div class="mt-2">
                                <span class="text-3xl font-bold">0</span>
                                <span class="text-gray-600"> ريال/شهر</span>
                            </div>
                        </div>
                        
                        <ul class="space-y-3 mb-6">
                            <li class="flex items-center text-sm">
                                <span class="text-green-500 ml-2">✓</span>
                                حتى 100 محادثة شهرياً
                            </li>
                            <li class="flex items-center text-sm">
                                <span class="text-green-500 ml-2">✓</span>
                                5 قوالب رسائل أساسية
                            </li>
                            <li class="flex items-center text-sm">
                                <span class="text-green-500 ml-2">✓</span>
                                تقارير بسيطة
                            </li>
                            <li class="flex items-center text-sm">
                                <span class="text-green-500 ml-2">✓</span>
                                دعم عبر البريد الإلكتروني
                            </li>
                            <li class="flex items-center text-sm text-gray-400">
                                <span class="text-red-500 ml-2">✗</span>
                                بدون مساعد ذكي
                            </li>
                            <li class="flex items-center text-sm text-gray-400">
                                <span class="text-red-500 ml-2">✗</span>
                                بدون أتمتة متقدمة
                            </li>
                        </ul>
                        
                        <button class="w-full bg-gray-300 text-gray-500 py-3 rounded-lg cursor-not-allowed">
                            الباقة الحالية
                        </button>
                    </div>
                    
                    <!-- الباقة الاحترافية -->
                    <div class="border-2 border-emerald-500 rounded-xl p-6 relative bg-gradient-to-b from-emerald-50 to-white">
                        <div class="absolute -top-3 left-1/2 transform -translate-x-1/2">
                            <span class="bg-emerald-500 text-white px-4 py-1 rounded-full text-sm font-medium">الأكثر شعبية</span>
                        </div>
                        
                        <div class="text-center mb-6">
                            <h3 class="text-xl font-bold text-gray-900">الاحترافي</h3>
                            <div class="mt-2">
                                <span class="text-3xl font-bold text-emerald-600">299</span>
                                <span class="text-gray-600"> ريال/شهر</span>
                            </div>
                            <p class="text-sm text-emerald-600 mt-1">وفر 20% مع الدفع السنوي</p>
                        </div>
                        
                        <ul class="space-y-3 mb-6">
                            <li class="flex items-center text-sm">
                                <span class="text-green-500 ml-2">✓</span>
                                محادثات غير محدودة
                            </li>
                            <li class="flex items-center text-sm">
                                <span class="text-green-500 ml-2">✓</span>
                                50+ قالب رسائل متقدم
                            </li>
                            <li class="flex items-center text-sm">
                                <span class="text-green-500 ml-2">✓</span>
                                مساعد ذكي متقدم
                            </li>
                            <li class="flex items-center text-sm">
                                <span class="text-green-500 ml-2">✓</span>
                                تقارير مفصلة وتحليلات
                            </li>
                            <li class="flex items-center text-sm">
                                <span class="text-green-500 ml-2">✓</span>
                                أتمتة الرسائل
                            </li>
                            <li class="flex items-center text-sm">
                                <span class="text-green-500 ml-2">✓</span>
                                إدارة المخزون والفواتير
                            </li>
                            <li class="flex items-center text-sm">
                                <span class="text-green-500 ml-2">✓</span>
                                حملات تسويقية
                            </li>
                            <li class="flex items-center text-sm">
                                <span class="text-green-500 ml-2">✓</span>
                                دعم أولوية 24/7
                            </li>
                        </ul>
                        
                        <button onclick="showUpgradeModal('pro')" class="w-full bg-emerald-500 text-white py-3 rounded-lg hover:bg-emerald-600 transition-colors font-medium">
                            ترقية للاحترافي
                        </button>
                    </div>
                    
                    <!-- باقة المؤسسات -->
                    <div class="border border-gray-200 rounded-xl p-6 relative">
                        <div class="text-center mb-6">
                            <h3 class="text-xl font-bold text-gray-900">المؤسسات</h3>
                            <div class="mt-2">
                                <span class="text-3xl font-bold">899</span>
                                <span class="text-gray-600"> ريال/شهر</span>
                            </div>
                        </div>
                        
                        <ul class="space-y-3 mb-6">
                            <li class="flex items-center text-sm">
                                <span class="text-green-500 ml-2">✓</span>
                                جميع مميزات الاحترافي
                            </li>
                            <li class="flex items-center text-sm">
                                <span class="text-green-500 ml-2">✓</span>
                                فرق عمل متعددة
                            </li>
                            <li class="flex items-center text-sm">
                                <span class="text-green-500 ml-2">✓</span>
                                أدوار وصلاحيات مخصصة
                            </li>
                            <li class="flex items-center text-sm">
                                <span class="text-green-500 ml-2">✓</span>
                                تكامل CRM متقدم
                            </li>
                            <li class="flex items-center text-sm">
                                <span class="text-green-500 ml-2">✓</span>
                                API مخصص
                            </li>
                            <li class="flex items-center text-sm">
                                <span class="text-green-500 ml-2">✓</span>
                                مدير حساب مخصص
                            </li>
                        </ul>
                        
                        <button onclick="showUpgradeModal('enterprise')" class="w-full bg-gray-900 text-white py-3 rounded-lg hover:bg-gray-800 transition-colors font-medium">
                            تواصل للمؤسسات
                        </button>
                    </div>
                </div>
                
                <!-- مقارنة المميزات -->
                <div class="mt-12">
                    <h3 class="text-xl font-bold text-gray-900 mb-6 text-center">مقارنة شاملة للمميزات</h3>
                    
                    <div class="overflow-x-auto">
                        <table class="w-full border border-gray-200 rounded-lg">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-4 py-3 text-right text-sm font-medium text-gray-900">الميزة</th>
                                    <th class="px-4 py-3 text-center text-sm font-medium text-gray-900">المجاني</th>
                                    <th class="px-4 py-3 text-center text-sm font-medium text-gray-900">الاحترافي</th>
                                    <th class="px-4 py-3 text-center text-sm font-medium text-gray-900">المؤسسات</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-200">
                                <tr>
                                    <td class="px-4 py-3 text-sm text-gray-900">عدد المحادثات</td>
                                    <td class="px-4 py-3 text-center text-sm">100/شهر</td>
                                    <td class="px-4 py-3 text-center text-sm text-emerald-600">غير محدود</td>
                                    <td class="px-4 py-3 text-center text-sm text-emerald-600">غير محدود</td>
                                </tr>
                                <tr class="bg-gray-50">
                                    <td class="px-4 py-3 text-sm text-gray-900">المساعد الذكي</td>
                                    <td class="px-4 py-3 text-center text-sm text-red-500">✗</td>
                                    <td class="px-4 py-3 text-center text-sm text-emerald-600">✓</td>
                                    <td class="px-4 py-3 text-center text-sm text-emerald-600">✓ متقدم</td>
                                </tr>
                                <tr>
                                    <td class="px-4 py-3 text-sm text-gray-900">قوالب الرسائل</td>
                                    <td class="px-4 py-3 text-center text-sm">5 أساسية</td>
                                    <td class="px-4 py-3 text-center text-sm text-emerald-600">50+ متقدمة</td>
                                    <td class="px-4 py-3 text-center text-sm text-emerald-600">غير محدود + مخصص</td>
                                </tr>
                                <tr class="bg-gray-50">
                                    <td class="px-4 py-3 text-sm text-gray-900">التقارير والتحليلات</td>
                                    <td class="px-4 py-3 text-center text-sm">بسيطة</td>
                                    <td class="px-4 py-3 text-center text-sm text-emerald-600">مفصلة</td>
                                    <td class="px-4 py-3 text-center text-sm text-emerald-600">متقدمة + مخصصة</td>
                                </tr>
                                <tr>
                                    <td class="px-4 py-3 text-sm text-gray-900">الدعم الفني</td>
                                    <td class="px-4 py-3 text-center text-sm">بريد إلكتروني</td>
                                    <td class="px-4 py-3 text-center text-sm text-emerald-600">أولوية 24/7</td>
                                    <td class="px-4 py-3 text-center text-sm text-emerald-600">مدير حساب مخصص</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- نافذة الترقية -->
    <div id="upgradeModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-xl max-w-md w-full p-6">
            <div class="text-center mb-6">
                <div class="w-16 h-16 bg-emerald-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <span class="text-2xl">🚀</span>
                </div>
                <h3 class="text-xl font-bold text-gray-900 mb-2">ترقية للباقة الاحترافية</h3>
                <p class="text-gray-600">احصل على جميع المميزات المتقدمة</p>
            </div>
            
            <div class="space-y-4 mb-6">
                <div class="flex items-center justify-between p-3 bg-emerald-50 rounded-lg">
                    <span class="text-sm font-medium">الباقة الاحترافية</span>
                    <span class="text-lg font-bold text-emerald-600">299 ريال/شهر</span>
                </div>
                
                <div class="text-sm text-gray-600">
                    <p class="mb-2">✅ محادثات غير محدودة</p>
                    <p class="mb-2">✅ مساعد ذكي متقدم</p>
                    <p class="mb-2">✅ تقارير مفصلة</p>
                    <p class="mb-2">✅ أتمتة الرسائل</p>
                    <p>✅ دعم أولوية 24/7</p>
                </div>
            </div>
            
            <div class="space-y-3">
                <button onclick="processUpgrade()" class="w-full bg-emerald-500 text-white py-3 rounded-lg hover:bg-emerald-600 transition-colors font-medium">
                    ترقية الآن - 299 ريال/شهر
                </button>
                <button onclick="hideUpgradeModal()" class="w-full border border-gray-300 text-gray-700 py-3 rounded-lg hover:bg-gray-50 transition-colors">
                    إلغاء
                </button>
            </div>
            
            <p class="text-xs text-gray-500 text-center mt-4">
                يمكنك إلغاء الاشتراك في أي وقت. بدون التزامات طويلة المدى.
            </p>
        </div>
    </div>

    <!-- لوحة التحكم -->
    <div id="dashboard" class="hidden fixed inset-0 bg-white z-40">
        <div class="h-full flex flex-col">
            <header class="bg-white border-b border-gray-200 px-4 md:px-6 py-3 md:py-4 flex items-center justify-between">
                <h1 class="text-lg md:text-2xl font-bold text-gray-900">لوحة التحكم</h1>
                <button onclick="hideDashboard()" class="text-gray-600 hover:bg-gray-100 p-2 rounded-lg">
                    ✕
                </button>
            </header>
            
            <div class="flex-1 overflow-y-auto p-4 md:p-6">
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 md:gap-6 mb-6 md:mb-8" id="dashboardStats">
                    <!-- سيتم ملؤها ديناميكياً -->
                </div>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="bg-white p-6 rounded-xl border border-gray-200">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">أداء المبيعات</h3>
                        <div class="h-64 flex items-center justify-center bg-gray-50 rounded-lg">
                            <canvas id="dashboardChart" width="400" height="200"></canvas>
                        </div>
                    </div>
                    
                    <div class="bg-white p-6 rounded-xl border border-gray-200">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">الطلبات الأخيرة</h3>
                        <div class="space-y-4" id="recentOrders">
                            <!-- سيتم ملؤها ديناميكياً -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let isDarkMode = false;
        let currentCurrency = 'SAR';
        let businessName = '';
        let scheduledMessages = [];
        let selectedImages = [];
        let currentLanguage = 'ar';
        let notifications = true;
        let autoReply = false;
        
        // قاعدة بيانات ضخمة وهمية - محاكاة 180 يوم من البيانات الواقعية
        const database = {
            // إعدادات النظام
            settings: {
                businessName: 'مشاري بزنس',
                currency: 'SAR',
                language: 'ar',
                timezone: 'Asia/Riyadh',
                theme: 'light',
                subscription: 'free', // free, pro
                subscriptionExpiry: '2024-06-15',
                features: {
                    aiAssistant: false,
                    advancedReports: false,
                    bulkMessaging: false,
                    customTemplates: false,
                    prioritySupport: false
                }
            },

            // العملاء - قاعدة بيانات ضخمة
            customers: [
                // عملاء VIP
                { id: 1, name: 'محمد أحمد الراشد', phone: '+966501234567', email: 'mohammed.alrashed@email.com', totalOrders: 45, totalSpent: 125000, lastOrder: '2024-01-15', status: 'VIP', avatar: 'م', color: 'bg-blue-500', tags: ['VIP', 'مخلص', 'شراء بالجملة'], joinDate: '2023-08-15', lastSeen: '2024-01-15 14:30', notes: 'عميل مميز، يفضل التواصل صباحاً' },
                { id: 2, name: 'Sarah Johnson', phone: '+966507654321', email: 'sarah.johnson@email.com', totalOrders: 38, totalSpent: 98500, lastOrder: '2024-01-14', status: 'VIP', avatar: 'S', color: 'bg-purple-500', tags: ['VIP', 'International', 'Tech'], joinDate: '2023-07-22', lastSeen: '2024-01-14 16:45', notes: 'Prefers English communication' },
                { id: 3, name: 'أحمد خالد المنصور', phone: '+966509876543', email: 'ahmed.almansour@email.com', totalOrders: 52, totalSpent: 189000, lastOrder: '2024-01-13', status: 'VIP', avatar: 'أ', color: 'bg-red-500', tags: ['VIP', 'شركة', 'دفع سريع'], joinDate: '2023-06-10', lastSeen: '2024-01-13 11:20', notes: 'مدير شركة، يحتاج فواتير رسمية' },
                
                // عملاء عاديون
                { id: 4, name: 'فاطمة محمد العتيبي', phone: '+966502468135', email: 'fatima.alotaibi@email.com', totalOrders: 15, totalSpent: 32000, lastOrder: '2024-01-12', status: 'عادي', avatar: 'ف', color: 'bg-green-500', tags: ['منتظم', 'تقسيط'], joinDate: '2023-11-05', lastSeen: '2024-01-12 09:15', notes: 'تفضل التقسيط على دفعتين' },
                { id: 5, name: 'عبدالله سعد القحطاني', phone: '+966508642097', email: 'abdullah.alqahtani@email.com', totalOrders: 22, totalSpent: 67500, lastOrder: '2024-01-11', status: 'عادي', avatar: 'ع', color: 'bg-yellow-500', tags: ['منتظم', 'صيانة'], joinDate: '2023-09-18', lastSeen: '2024-01-11 20:30', notes: 'يحتاج خدمات صيانة دورية' },
                { id: 6, name: 'نورا حسن الغامدي', phone: '+966503691472', email: 'nora.alghamdi@email.com', totalOrders: 28, totalSpent: 84200, lastOrder: '2024-01-10', status: 'VIP', avatar: 'ن', color: 'bg-pink-500', tags: ['VIP', 'تصميم', 'إبداعي'], joinDate: '2023-08-03', lastSeen: '2024-01-10 13:45', notes: 'مصممة، تحتاج منتجات إبداعية' },
                
                // عملاء جدد
                { id: 7, name: 'خالد عمر الشهري', phone: '+966505827394', email: 'khalid.alshehri@email.com', totalOrders: 3, totalSpent: 8500, lastOrder: '2024-01-09', status: 'جديد', avatar: 'خ', color: 'bg-indigo-500', tags: ['جديد', 'محتمل'], joinDate: '2024-01-01', lastSeen: '2024-01-09 17:20', notes: 'عميل جديد، يحتاج متابعة' },
                { id: 8, name: 'ريم أحمد الدوسري', phone: '+966504715836', email: 'reem.aldosari@email.com', totalOrders: 7, totalSpent: 19300, lastOrder: '2024-01-08', status: 'عادي', avatar: 'ر', color: 'bg-teal-500', tags: ['منتظم', 'سريع'], joinDate: '2023-12-15', lastSeen: '2024-01-08 12:10', notes: 'تفضل التسليم السريع' },
                
                // المزيد من العملاء لمحاكاة قاعدة بيانات كبيرة
                { id: 9, name: 'علي محمد الحربي', phone: '+966501122334', email: 'ali.alharbi@email.com', totalOrders: 19, totalSpent: 45600, lastOrder: '2024-01-07', status: 'عادي', avatar: 'ع', color: 'bg-orange-500', tags: ['منتظم', 'جملة'], joinDate: '2023-10-12', lastSeen: '2024-01-07 15:30', notes: 'يشتري بكميات كبيرة' },
                { id: 10, name: 'مريم سالم الزهراني', phone: '+966507788990', email: 'mariam.alzahrani@email.com', totalOrders: 31, totalSpent: 72800, lastOrder: '2024-01-06', status: 'VIP', avatar: 'م', color: 'bg-cyan-500', tags: ['VIP', 'تسويق', 'شبكات'], joinDate: '2023-07-08', lastSeen: '2024-01-06 10:45', notes: 'تعمل في التسويق الرقمي' },
                
                // عملاء دوليون
                { id: 11, name: 'Ahmed Hassan', phone: '+971501234567', email: 'ahmed.hassan@email.com', totalOrders: 16, totalSpent: 38900, lastOrder: '2024-01-05', status: 'عادي', avatar: 'A', color: 'bg-lime-500', tags: ['دولي', 'UAE', 'شحن'], joinDate: '2023-11-20', lastSeen: '2024-01-05 14:20', notes: 'Customer from UAE, needs international shipping' },
                { id: 12, name: 'Fatima Al Zahra', phone: '+971507654321', email: 'fatima.alzahra@email.com', totalOrders: 24, totalSpent: 56700, lastOrder: '2024-01-04', status: 'VIP', avatar: 'F', color: 'bg-rose-500', tags: ['VIP', 'دولي', 'UAE'], joinDate: '2023-09-05', lastSeen: '2024-01-04 16:15', notes: 'Premium customer from Dubai' },
                
                // عملاء شركات
                { id: 13, name: 'شركة الرياض للتقنية', phone: '+966112345678', email: 'info@riyadhtech.com', totalOrders: 67, totalSpent: 234500, lastOrder: '2024-01-03', status: 'VIP', avatar: 'ش', color: 'bg-violet-500', tags: ['شركة', 'VIP', 'تقنية', 'B2B'], joinDate: '2023-05-15', lastSeen: '2024-01-03 11:30', notes: 'شركة كبيرة، طلبات منتظمة شهرياً' },
                { id: 14, name: 'مؤسسة النور التجارية', phone: '+966113456789', email: 'orders@alnoor.com', totalOrders: 43, totalSpent: 156800, lastOrder: '2024-01-02', status: 'VIP', avatar: 'ن', color: 'bg-amber-500', tags: ['مؤسسة', 'VIP', 'تجارة'], joinDate: '2023-06-28', lastSeen: '2024-01-02 09:45', notes: 'مؤسسة تجارية، تحتاج فواتير ضريبية' },
                
                // عملاء موسميون
                { id: 15, name: 'سعد عبدالعزيز الغامدي', phone: '+966509988776', email: 'saad.alghamdi@email.com', totalOrders: 8, totalSpent: 23400, lastOrder: '2023-12-20', status: 'موسمي', avatar: 'س', color: 'bg-emerald-500', tags: ['موسمي', 'رمضان', 'هدايا'], joinDate: '2023-03-15', lastSeen: '2023-12-20 18:30', notes: 'يشتري في المواسم فقط' }
            ],
            
            // كتالوج المنتجات الضخم
            products: [
                // إلكترونيات متقدمة
                { id: 1, name: 'جهاز لابتوب Dell XPS 15', price: 8500, cost: 6800, stock: 15, category: 'إلكترونيات', sales: 145, image: '💻', description: 'لابتوب عالي الأداء للمحترفين', sku: 'DELL-XPS-15-001', weight: '2.1kg', warranty: '3 سنوات', rating: 4.8, reviews: 234 },
                { id: 2, name: 'هاتف iPhone 15 Pro Max', price: 5200, cost: 4200, stock: 28, category: 'إلكترونيات', sales: 312, image: '📱', description: 'أحدث هاتف من آبل بكاميرا متطورة', sku: 'IPHONE-15-PM-001', weight: '221g', warranty: 'سنة واحدة', rating: 4.9, reviews: 567 },
                { id: 3, name: 'ساعة ذكية Apple Watch Ultra', price: 3200, cost: 2400, stock: 22, category: 'إكسسوارات', sales: 167, image: '⌚', description: 'ساعة ذكية للرياضيين والمغامرين', sku: 'WATCH-ULTRA-001', weight: '61.3g', warranty: 'سنة واحدة', rating: 4.7, reviews: 189 },
                { id: 4, name: 'سماعات AirPods Pro 2', price: 1150, cost: 820, stock: 45, category: 'إكسسوارات', sales: 289, image: '🎧', description: 'سماعات لاسلكية بإلغاء الضوضاء', sku: 'AIRPODS-PRO2-001', weight: '50.8g', warranty: 'سنة واحدة', rating: 4.6, reviews: 423 },
                { id: 5, name: 'كاميرا Canon EOS R5', price: 12800, cost: 9200, stock: 8, category: 'تصوير', sales: 43, image: '📷', description: 'كاميرا احترافية بدقة 45 ميجابكسل', sku: 'CANON-R5-001', weight: '738g', warranty: 'سنتان', rating: 4.9, reviews: 156 },
                { id: 6, name: 'تابلت iPad Pro 12.9', price: 4400, cost: 3200, stock: 18, category: 'إلكترونيات', sales: 98, image: '📱', description: 'تابلت احترافي بشاشة Liquid Retina', sku: 'IPAD-PRO-129-001', weight: '682g', warranty: 'سنة واحدة', rating: 4.8, reviews: 267 },
                
                // إكسسوارات متنوعة
                { id: 7, name: 'لوحة مفاتيح ميكانيكية RGB', price: 650, cost: 420, stock: 35, category: 'إكسسوارات', sales: 176, image: '⌨️', description: 'لوحة مفاتيح للألعاب بإضاءة RGB', sku: 'KEYBOARD-RGB-001', weight: '1.2kg', warranty: 'سنتان', rating: 4.5, reviews: 89 },
                { id: 8, name: 'ماوس لاسلكي Logitech MX', price: 380, cost: 220, stock: 52, category: 'إكسسوارات', sales: 234, image: '🖱️', description: 'ماوس لاسلكي عالي الدقة للمحترفين', sku: 'MOUSE-MX-001', weight: '141g', warranty: 'سنة واحدة', rating: 4.7, reviews: 145 },
                { id: 9, name: 'شاشة Samsung 4K 32 بوصة', price: 2200, cost: 1600, stock: 12, category: 'إلكترونيات', sales: 67, image: '🖥️', description: 'شاشة 4K للتصميم والألعاب', sku: 'MONITOR-32-4K-001', weight: '7.2kg', warranty: '3 سنوات', rating: 4.6, reviews: 78 },
                { id: 10, name: 'هارد SSD خارجي 2TB', price: 850, cost: 580, stock: 28, category: 'تخزين', sales: 156, image: '💾', description: 'قرص صلب خارجي عالي السرعة', sku: 'SSD-EXT-2TB-001', weight: '150g', warranty: '5 سنوات', rating: 4.8, reviews: 234 },
                
                // منتجات المنزل الذكي
                { id: 11, name: 'مكبر صوت ذكي Amazon Echo', price: 450, cost: 280, stock: 40, category: 'منزل ذكي', sales: 189, image: '🔊', description: 'مكبر صوت ذكي مع مساعد Alexa', sku: 'ECHO-DOT-001', weight: '328g', warranty: 'سنة واحدة', rating: 4.4, reviews: 567 },
                { id: 12, name: 'كاميرا مراقبة ذكية', price: 320, cost: 180, stock: 33, category: 'أمان', sales: 123, image: '📹', description: 'كاميرا مراقبة بالذكاء الاصطناعي', sku: 'CAM-SMART-001', weight: '200g', warranty: 'سنتان', rating: 4.3, reviews: 89 },
                { id: 13, name: 'مصباح ذكي Philips Hue', price: 180, cost: 110, stock: 60, category: 'إضاءة', sales: 267, image: '💡', description: 'مصباح LED ذكي بألوان متعددة', sku: 'BULB-HUE-001', weight: '132g', warranty: 'سنتان', rating: 4.5, reviews: 345 },
                
                // منتجات الألعاب
                { id: 14, name: 'PlayStation 5 Console', price: 2100, cost: 1650, stock: 6, category: 'ألعاب', sales: 78, image: '🎮', description: 'جهاز ألعاب الجيل الجديد من سوني', sku: 'PS5-CONSOLE-001', weight: '4.5kg', warranty: 'سنة واحدة', rating: 4.9, reviews: 1234 },
                { id: 15, name: 'يد تحكم Xbox Wireless', price: 280, cost: 180, stock: 25, category: 'ألعاب', sales: 145, image: '🎮', description: 'يد تحكم لاسلكية لجهاز Xbox', sku: 'XBOX-CONTROLLER-001', weight: '287g', warranty: 'سنة واحدة', rating: 4.6, reviews: 456 },
                
                // منتجات الصحة واللياقة
                { id: 16, name: 'ميزان ذكي Xiaomi', price: 120, cost: 70, stock: 45, category: 'صحة', sales: 234, image: '⚖️', description: 'ميزان ذكي لقياس الوزن والدهون', sku: 'SCALE-SMART-001', weight: '1.6kg', warranty: 'سنة واحدة', rating: 4.4, reviews: 189 },
                { id: 17, name: 'سوار لياقة Fitbit', price: 680, cost: 450, stock: 30, category: 'صحة', sales: 167, image: '⌚', description: 'سوار لتتبع اللياقة البدنية والصحة', sku: 'FITBIT-BAND-001', weight: '25g', warranty: 'سنة واحدة', rating: 4.3, reviews: 278 },
                
                // منتجات السيارات
                { id: 18, name: 'شاحن سيارة لاسلكي', price: 150, cost: 85, stock: 55, category: 'سيارات', sales: 189, image: '🔌', description: 'شاحن لاسلكي للهاتف في السيارة', sku: 'CAR-CHARGER-001', weight: '180g', warranty: 'سنة واحدة', rating: 4.2, reviews: 123 },
                { id: 19, name: 'كاميرا تسجيل السيارة', price: 420, cost: 250, stock: 20, category: 'سيارات', sales: 98, image: '📹', description: 'كاميرا تسجيل عالية الدقة للسيارة', sku: 'DASHCAM-HD-001', weight: '95g', warranty: 'سنتان', rating: 4.5, reviews: 167 },
                
                // منتجات المكتب
                { id: 20, name: 'كرسي مكتب مريح', price: 1200, cost: 750, stock: 15, category: 'مكتب', sales: 67, image: '🪑', description: 'كرسي مكتب بتصميم مريح وداعم للظهر', sku: 'CHAIR-OFFICE-001', weight: '18kg', warranty: '5 سنوات', rating: 4.7, reviews: 234 }
            ],

            // قوالب الرسائل المتقدمة
            templates: [
                // قوالب الترحيب
                { id: 1, name: 'ترحيب عميل جديد', category: 'ترحيب', content: 'مرحباً {name}! 🎉\n\nأهلاً وسهلاً بك في {business_name}\nنحن سعداء لانضمامك إلى عائلتنا من العملاء المميزين.\n\nيمكنك تصفح منتجاتنا والاستفسار عن أي شيء في أي وقت.\n\nشكراً لثقتك بنا! 💙', variables: ['name', 'business_name'], usage: 234 },
                { id: 2, name: 'ترحيب VIP', category: 'ترحيب', content: 'مرحباً {name} 👑\n\nكعميل VIP مميز، لديك الأولوية في:\n✅ الدعم الفوري\n✅ خصومات حصرية\n✅ منتجات جديدة قبل الجميع\n\nكيف يمكنني مساعدتك اليوم؟', variables: ['name'], usage: 89 },
                
                // قوالب عروض الأسعار
                { id: 3, name: 'عرض سعر منتج واحد', category: 'عروض', content: '📋 عرض سعر - {product_name}\n\n💰 السعر: {price} {currency}\n📦 متوفر في المخزن: {stock} قطعة\n🚚 التوصيل: مجاني للطلبات أكثر من 500 ريال\n⏰ العرض ساري لمدة 48 ساعة\n\nهل تود المتابعة مع الطلب؟', variables: ['product_name', 'price', 'currency', 'stock'], usage: 456 },
                { id: 4, name: 'عرض سعر مجموعة منتجات', category: 'عروض', content: '📋 عرض سعر شامل\n\n{products_list}\n\n💰 المجموع: {total} {currency}\n🎁 خصم خاص: {discount}%\n💳 المجموع بعد الخصم: {final_total} {currency}\n\n✨ عرض محدود لمدة 24 ساعة فقط!', variables: ['products_list', 'total', 'currency', 'discount', 'final_total'], usage: 178 },
                
                // قوالب تأكيد الطلبات
                { id: 5, name: 'تأكيد طلب جديد', category: 'طلبات', content: '✅ تم تأكيد طلبك!\n\n📋 رقم الطلب: #{order_id}\n📅 التاريخ: {date}\n💰 المبلغ: {amount} {currency}\n🚚 التوصيل المتوقع: {delivery_date}\n\nسنرسل لك رابط تتبع الشحنة قريباً.\nشكراً لثقتك بنا! 🙏', variables: ['order_id', 'date', 'amount', 'currency', 'delivery_date'], usage: 567 },
                { id: 6, name: 'تحديث حالة الطلب', category: 'طلبات', content: '📦 تحديث طلبك #{order_id}\n\n🔄 الحالة الحالية: {status}\n📍 الموقع: {location}\n⏰ التوقيت المتوقع: {estimated_time}\n\n🔗 تتبع الشحنة: {tracking_link}', variables: ['order_id', 'status', 'location', 'estimated_time', 'tracking_link'], usage: 345 },
                
                // قوالب المتابعة
                { id: 7, name: 'متابعة بعد الشراء', category: 'متابعة', content: 'مرحباً {name}! 😊\n\nنأمل أن تكون راضياً عن {product_name}\n\n⭐ نود معرفة رأيك:\n- هل المنتج يلبي توقعاتك؟\n- هل تحتاج أي مساعدة؟\n\nتقييمك يهمنا كثيراً! 💙', variables: ['name', 'product_name'], usage: 234 },
                { id: 8, name: 'تذكير دفع متأخر', category: 'متابعة', content: '⏰ تذكير ودود\n\nعزيزي {name},\nلديك فاتورة مستحقة الدفع:\n\n📋 رقم الفاتورة: #{invoice_id}\n💰 المبلغ: {amount} {currency}\n📅 تاريخ الاستحقاق: {due_date}\n\nيمكنك الدفع عبر: {payment_link}', variables: ['name', 'invoice_id', 'amount', 'currency', 'due_date', 'payment_link'], usage: 123 },
                
                // قوالب التسويق
                { id: 9, name: 'إعلان منتج جديد', category: 'تسويق', content: '🚀 منتج جديد وصل!\n\n✨ {product_name}\n💰 سعر الإطلاق: {price} {currency}\n🎁 خصم الأوائل: {discount}%\n\n📸 {product_image}\n\n⏰ العرض محدود لأول 50 عميل فقط!\nاطلب الآن 👇', variables: ['product_name', 'price', 'currency', 'discount', 'product_image'], usage: 189 },
                { id: 10, name: 'عرض موسمي', category: 'تسويق', content: '🎉 عرض {season_name} الكبير!\n\n🔥 خصومات تصل إلى {max_discount}%\n📅 من {start_date} إلى {end_date}\n\n🛍️ تسوق الآن واستفد من:\n✅ شحن مجاني\n✅ ضمان مدى الحياة\n✅ خدمة عملاء 24/7', variables: ['season_name', 'max_discount', 'start_date', 'end_date'], usage: 267 },
                
                // قوالب الدعم الفني
                { id: 11, name: 'استلام شكوى', category: 'دعم', content: 'شكراً لتواصلك معنا {name}\n\n📝 تم تسجيل شكواك برقم: #{ticket_id}\n⏰ سنرد عليك خلال: {response_time}\n👨‍💻 المختص المسؤول: {agent_name}\n\nنعتذر عن أي إزعاج ونعدك بحل سريع! 🙏', variables: ['name', 'ticket_id', 'response_time', 'agent_name'], usage: 78 },
                { id: 12, name: 'حل مشكلة', category: 'دعم', content: '✅ تم حل مشكلتك!\n\nمرحباً {name},\nيسعدنا إخبارك أن المشكلة #{ticket_id} تم حلها بنجاح.\n\n📋 الحل المطبق: {solution}\n⏰ وقت الحل: {resolution_time}\n\nهل أنت راضٍ عن الخدمة؟ نود تقييمك 🌟', variables: ['name', 'ticket_id', 'solution', 'resolution_time'], usage: 156 }
            ],
            
            // الطلبات مع تفاصيل شاملة
            orders: [
                { id: 1001, customerId: 1, customerName: 'محمد أحمد الراشد', items: [{ productId: 1, productName: 'جهاز لابتوب Dell XPS 15', quantity: 1, price: 8500 }], total: 8500, status: 'مكتمل', date: '2024-01-15', paymentMethod: 'بطاقة ائتمان', shippingAddress: 'الرياض، حي النرجس', trackingNumber: 'TRK123456789', deliveryDate: '2024-01-17', notes: 'تسليم سريع' },
                { id: 1002, customerId: 2, customerName: 'Sarah Johnson', items: [{ productId: 4, productName: 'سماعات AirPods Pro 2', quantity: 2, price: 1150 }], total: 2300, status: 'قيد الشحن', date: '2024-01-14', paymentMethod: 'تحويل بنكي', shippingAddress: 'Dubai, Marina District', trackingNumber: 'TRK987654321', deliveryDate: '2024-01-18', notes: 'International shipping' },
                { id: 1003, customerId: 3, customerName: 'أحمد خالد المنصور', items: [{ productId: 2, productName: 'هاتف iPhone 15 Pro Max', quantity: 1, price: 5200 }, { productId: 3, productName: 'ساعة ذكية Apple Watch Ultra', quantity: 1, price: 3200 }], total: 8400, status: 'جديد', date: '2024-01-13', paymentMethod: 'نقداً', shippingAddress: 'جدة، حي الروضة', trackingNumber: '', deliveryDate: '2024-01-20', notes: 'طلب شركة' },
                { id: 1004, customerId: 4, customerName: 'فاطمة محمد العتيبي', items: [{ productId: 16, productName: 'ميزان ذكي Xiaomi', quantity: 1, price: 120 }, { productId: 17, productName: 'سوار لياقة Fitbit', quantity: 1, price: 680 }], total: 800, status: 'مكتمل', date: '2024-01-12', paymentMethod: 'تقسيط', shippingAddress: 'الدمام، حي الفيصلية', trackingNumber: 'TRK456789123', deliveryDate: '2024-01-14', notes: 'دفع على دفعتين' },
                { id: 1005, customerId: 5, customerName: 'عبدالله سعد القحطاني', items: [{ productId: 7, productName: 'لوحة مفاتيح ميكانيكية RGB', quantity: 2, price: 650 }, { productId: 8, productName: 'ماوس لاسلكي Logitech MX', quantity: 2, price: 380 }], total: 2060, status: 'ملغي', date: '2024-01-11', paymentMethod: 'تحويل بنكي', shippingAddress: 'أبها، حي المنهل', trackingNumber: '', deliveryDate: '', notes: 'ألغى العميل الطلب' },
                { id: 1006, customerId: 6, customerName: 'نورا حسن الغامدي', items: [{ productId: 5, productName: 'كاميرا Canon EOS R5', quantity: 1, price: 12800 }], total: 12800, status: 'مكتمل', date: '2024-01-10', paymentMethod: 'نقداً', shippingAddress: 'الطائف، حي الشفا', trackingNumber: 'TRK789123456', deliveryDate: '2024-01-12', notes: 'عميلة مصممة' },
                { id: 1007, customerId: 7, customerName: 'خالد عمر الشهري', items: [{ productId: 18, productName: 'شاحن سيارة لاسلكي', quantity: 3, price: 150 }, { productId: 19, productName: 'كاميرا تسجيل السيارة', quantity: 1, price: 420 }], total: 870, status: 'قيد التنفيذ', date: '2024-01-09', paymentMethod: 'بطاقة ائتمان', shippingAddress: 'خميس مشيط، حي المطار', trackingNumber: 'TRK321654987', deliveryDate: '2024-01-16', notes: 'عميل جديد' },
                { id: 1008, customerId: 8, customerName: 'ريم أحمد الدوسري', items: [{ productId: 6, productName: 'تابلت iPad Pro 12.9', quantity: 1, price: 4400 }], total: 4400, status: 'جديد', date: '2024-01-08', paymentMethod: 'تحويل بنكي', shippingAddress: 'الخبر، حي الراكة', trackingNumber: '', deliveryDate: '2024-01-15', notes: 'تسليم سريع مطلوب' },
                
                // طلبات إضافية لمحاكاة قاعدة بيانات كبيرة
                { id: 1009, customerId: 9, customerName: 'علي محمد الحربي', items: [{ productId: 11, productName: 'مكبر صوت ذكي Amazon Echo', quantity: 5, price: 450 }], total: 2250, status: 'مكتمل', date: '2024-01-07', paymentMethod: 'نقداً', shippingAddress: 'المدينة المنورة، حي العوالي', trackingNumber: 'TRK654987321', deliveryDate: '2024-01-09', notes: 'طلب بالجملة' },
                { id: 1010, customerId: 10, customerName: 'مريم سالم الزهراني', items: [{ productId: 13, productName: 'مصباح ذكي Philips Hue', quantity: 8, price: 180 }], total: 1440, status: 'مكتمل', date: '2024-01-06', paymentMethod: 'بطاقة ائتمان', shippingAddress: 'مكة المكرمة، حي العزيزية', trackingNumber: 'TRK147258369', deliveryDate: '2024-01-08', notes: 'مشروع إضاءة منزل' },
                { id: 1011, customerId: 11, customerName: 'Ahmed Hassan', items: [{ productId: 14, productName: 'PlayStation 5 Console', quantity: 1, price: 2100 }, { productId: 15, productName: 'يد تحكم Xbox Wireless', quantity: 2, price: 280 }], total: 2660, status: 'قيد الشحن', date: '2024-01-05', paymentMethod: 'بطاقة ائتمان', shippingAddress: 'Abu Dhabi, Khalifa City', trackingNumber: 'TRK963852741', deliveryDate: '2024-01-12', notes: 'International order to UAE' },
                { id: 1012, customerId: 12, customerName: 'Fatima Al Zahra', items: [{ productId: 9, productName: 'شاشة Samsung 4K 32 بوصة', quantity: 2, price: 2200 }], total: 4400, status: 'مكتمل', date: '2024-01-04', paymentMethod: 'تحويل بنكي', shippingAddress: 'Dubai, Business Bay', trackingNumber: 'TRK741852963', deliveryDate: '2024-01-07', notes: 'Office setup' },
                { id: 1013, customerId: 13, customerName: 'شركة الرياض للتقنية', items: [{ productId: 1, productName: 'جهاز لابتوب Dell XPS 15', quantity: 10, price: 8500 }, { productId: 9, productName: 'شاشة Samsung 4K 32 بوصة', quantity: 10, price: 2200 }], total: 107000, status: 'مكتمل', date: '2024-01-03', paymentMethod: 'تحويل بنكي', shippingAddress: 'الرياض، حي الملك عبدالله المالي', trackingNumber: 'TRK159357486', deliveryDate: '2024-01-05', notes: 'طلب شركة كبير' },
                { id: 1014, customerId: 14, customerName: 'مؤسسة النور التجارية', items: [{ productId: 10, productName: 'هارد SSD خارجي 2TB', quantity: 20, price: 850 }], total: 17000, status: 'قيد التنفيذ', date: '2024-01-02', paymentMethod: 'شيك', shippingAddress: 'الرياض، حي الصحافة', trackingNumber: 'TRK357486159', deliveryDate: '2024-01-10', notes: 'طلب مؤسسة تجارية' },
                { id: 1015, customerId: 15, customerName: 'سعد عبدالعزيز الغامدي', items: [{ productId: 13, productName: 'مصباح ذكي Philips Hue', quantity: 12, price: 180 }], total: 2160, status: 'مكتمل', date: '2023-12-20', paymentMethod: 'نقداً', shippingAddress: 'الباحة، حي الظفير', trackingNumber: 'TRK486159357', deliveryDate: '2023-12-22', notes: 'طلب موسمي - رمضان' }
            ],

            // الفواتير المفصلة
            invoices: [
                { id: 'INV-2024-001', orderId: 1001, customerId: 1, customerName: 'محمد أحمد الراشد', amount: 8500, tax: 1275, total: 9775, status: 'مدفوعة', issueDate: '2024-01-15', dueDate: '2024-01-30', paidDate: '2024-01-16', paymentMethod: 'بطاقة ائتمان', notes: 'فاتورة ضريبية' },
                { id: 'INV-2024-002', orderId: 1002, customerId: 2, customerName: 'Sarah Johnson', amount: 2300, tax: 345, total: 2645, status: 'مدفوعة', issueDate: '2024-01-14', dueDate: '2024-01-29', paidDate: '2024-01-15', paymentMethod: 'تحويل بنكي', notes: 'International invoice' },
                { id: 'INV-2024-003', orderId: 1003, customerId: 3, customerName: 'أحمد خالد المنصور', amount: 8400, tax: 1260, total: 9660, status: 'معلقة', issueDate: '2024-01-13', dueDate: '2024-01-28', paidDate: '', paymentMethod: '', notes: 'في انتظار الدفع' },
                { id: 'INV-2024-004', orderId: 1004, customerId: 4, customerName: 'فاطمة محمد العتيبي', amount: 800, tax: 120, total: 920, status: 'مدفوعة جزئياً', issueDate: '2024-01-12', dueDate: '2024-01-27', paidDate: '2024-01-13', paymentMethod: 'تقسيط', notes: 'دفع 460 ريال، متبقي 460' },
                { id: 'INV-2024-005', orderId: 1006, customerId: 6, customerName: 'نورا حسن الغامدي', amount: 12800, tax: 1920, total: 14720, status: 'مدفوعة', issueDate: '2024-01-10', dueDate: '2024-01-25', paidDate: '2024-01-11', paymentMethod: 'نقداً', notes: 'دفع فوري' },
                { id: 'INV-2024-006', orderId: 1009, customerId: 9, customerName: 'علي محمد الحربي', amount: 2250, tax: 337.5, total: 2587.5, status: 'مدفوعة', issueDate: '2024-01-07', dueDate: '2024-01-22', paidDate: '2024-01-08', paymentMethod: 'نقداً', notes: 'خصم 5% للجملة' },
                { id: 'INV-2024-007', orderId: 1013, customerId: 13, customerName: 'شركة الرياض للتقنية', amount: 107000, tax: 16050, total: 123050, status: 'مدفوعة', issueDate: '2024-01-03', dueDate: '2024-02-03', paidDate: '2024-01-05', paymentMethod: 'تحويل بنكي', notes: 'فاتورة شركة - خصم 10%' },
                { id: 'INV-2024-008', orderId: 1014, customerId: 14, customerName: 'مؤسسة النور التجارية', amount: 17000, tax: 2550, total: 19550, status: 'معلقة', issueDate: '2024-01-02', dueDate: '2024-02-02', paidDate: '', paymentMethod: '', notes: 'في انتظار الشيك' }
            ],
            
            // المحادثات المتقدمة مع رسائل واقعية
            chats: [
                { 
                    id: 1, 
                    customerId: 1, 
                    customerName: 'محمد أحمد الراشد', 
                    lastMessage: 'ممتاز! سأنتظر وصول اللابتوب غداً', 
                    time: '14:30', 
                    unread: 0, 
                    avatar: 'م', 
                    color: 'bg-blue-500',
                    status: 'online',
                    messages: [
                        { id: 1, text: 'مرحباً، أريد عرض سعر للابتوب الجديد Dell XPS 15', sender: 'customer', time: '10:25', status: 'read' },
                        { id: 2, text: 'أهلاً وسهلاً أستاذ محمد! 💻\n\nDell XPS 15 متوفر بالمواصفات التالية:\n• معالج Intel i7 الجيل 13\n• ذاكرة 32GB RAM\n• قرص SSD 1TB\n• شاشة 4K OLED\n\n💰 السعر: 8,500 ريال\n🚚 التوصيل مجاني\n⚡ متوفر للتسليم الفوري', sender: 'business', time: '10:26', status: 'read' },
                        { id: 3, text: 'السعر ممتاز! هل يمكن التسليم غداً؟', sender: 'customer', time: '10:27', status: 'read' },
                        { id: 4, text: 'بالطبع! سيصلك غداً بإذن الله 📦\n\nهل تفضل الدفع نقداً عند الاستلام أم تحويل بنكي؟', sender: 'business', time: '10:28', status: 'read' },
                        { id: 5, text: 'سأدفع بالبطاقة الائتمانية', sender: 'customer', time: '10:30', status: 'read' },
                        { id: 6, text: '✅ تم تأكيد طلبك!\n\n📋 رقم الطلب: #1001\n💳 المبلغ: 8,500 ريال\n📅 التسليم: غداً 15 يناير\n📍 العنوان: الرياض، حي النرجس\n\nسنرسل لك رقم التتبع قريباً 🚛', sender: 'business', time: '10:32', status: 'read' },
                        { id: 7, text: 'ممتاز! سأنتظر وصول اللابتوب غداً', sender: 'customer', time: '14:30', status: 'delivered' }
                    ]
                },
                { 
                    id: 2, 
                    customerId: 2, 
                    customerName: 'Sarah Johnson', 
                    lastMessage: 'Perfect! Looking forward to receiving them', 
                    time: '16:45', 
                    unread: 0, 
                    avatar: 'S', 
                    color: 'bg-purple-500',
                    status: 'online',
                    messages: [
                        { id: 1, text: 'Hi! I\'m interested in AirPods Pro 2', sender: 'customer', time: '14:20', status: 'read' },
                        { id: 2, text: 'Hello Sarah! 🎧\n\nAirPods Pro 2 are available:\n• Active Noise Cancellation\n• Spatial Audio\n• Up to 30hrs battery\n• MagSafe charging case\n\n💰 Price: 1,150 SAR each\n🚚 Free shipping to Dubai\n📦 2-3 days delivery', sender: 'business', time: '14:21', status: 'read' },
                        { id: 3, text: 'Great! I need 2 pairs please', sender: 'customer', time: '14:22', status: 'read' },
                        { id: 4, text: '✅ Order confirmed!\n\n📋 Order #1002\n🎧 AirPods Pro 2 × 2\n💰 Total: 2,300 SAR\n📍 Dubai Marina District\n🚛 Tracking: TRK987654321\n\nEstimated delivery: Jan 18th', sender: 'business', time: '14:23', status: 'read' },
                        { id: 5, text: 'Perfect! Looking forward to receiving them', sender: 'customer', time: '16:45', status: 'delivered' }
                    ]
                },
                { 
                    id: 3, 
                    customerId: 3, 
                    customerName: 'أحمد خالد المنصور', 
                    lastMessage: 'شكراً، سأنتظر التحديث', 
                    time: '11:20', 
                    unread: 0, 
                    avatar: 'أ', 
                    color: 'bg-red-500',
                    status: 'away',
                    messages: [
                        { id: 1, text: 'مرحباً، أريد iPhone 15 Pro Max مع Apple Watch Ultra', sender: 'customer', time: '16:10', status: 'read' },
                        { id: 2, text: 'أهلاً أستاذ أحمد! 📱⌚\n\nالمنتجات متوفرة:\n• iPhone 15 Pro Max - 5,200 ريال\n• Apple Watch Ultra - 3,200 ريال\n\n💰 المجموع: 8,400 ريال\n🎁 خصم خاص للشركات: 5%\n💳 المجموع بعد الخصم: 7,980 ريال', sender: 'business', time: '16:11', status: 'read' },
                        { id: 3, text: 'ممتاز! متى التسليم؟', sender: 'customer', time: '16:15', status: 'read' },
                        { id: 4, text: '📦 سيتم التسليم خلال 3-5 أيام عمل\n📍 جدة، حي الروضة\n\nهل تفضل الدفع نقداً أم تحويل؟', sender: 'business', time: '16:16', status: 'read' },
                        { id: 5, text: 'نقداً عند الاستلام من فضلك', sender: 'customer', time: '16:18', status: 'read' },
                        { id: 6, text: '✅ تم تسجيل طلبك #1003\n\nسنتواصل معك لتأكيد موعد التسليم قريباً 📞', sender: 'business', time: '16:20', status: 'read' },
                        { id: 7, text: 'شكراً، سأنتظر التحديث', sender: 'customer', time: '11:20', status: 'delivered' }
                    ]
                },
                { 
                    id: 4, 
                    customerId: 4, 
                    customerName: 'فاطمة محمد العتيبي', 
                    lastMessage: 'شكراً لكم، الخدمة ممتازة! 🌟', 
                    time: '09:15', 
                    unread: 0, 
                    avatar: 'ف', 
                    color: 'bg-green-500',
                    status: 'offline',
                    messages: [
                        { id: 1, text: 'مرحباً، أريد منتجات للصحة واللياقة', sender: 'customer', time: '08:30', status: 'read' },
                        { id: 2, text: 'أهلاً أستاذة فاطمة! 💪\n\nلدينا مجموعة رائعة:\n• ميزان ذكي Xiaomi - 120 ريال\n• سوار لياقة Fitbit - 680 ريال\n\n🎯 مثالي لتتبع الصحة واللياقة\n💳 إمكانية التقسيط على دفعتين', sender: 'business', time: '08:32', status: 'read' },
                        { id: 3, text: 'ممتاز! أريد الاثنين مع التقسيط', sender: 'customer', time: '08:35', status: 'read' },
                        { id: 4, text: '✅ تم تأكيد طلبك #1004\n\n💰 المجموع: 800 ريال\n💳 الدفعة الأولى: 400 ريال\n💳 الدفعة الثانية: 400 ريال (بعد شهر)\n📦 التسليم: خلال يومين', sender: 'business', time: '08:37', status: 'read' },
                        { id: 5, text: 'تم استلام المنتجات! جودة ممتازة 👍', sender: 'customer', time: '09:10', status: 'read' },
                        { id: 6, text: 'نسعد بإعجابك! 😊\nكيف تقيمين تجربة التسوق معنا؟', sender: 'business', time: '09:12', status: 'read' },
                        { id: 7, text: 'شكراً لكم، الخدمة ممتازة! 🌟', sender: 'customer', time: '09:15', status: 'delivered' }
                    ]
                },
                { 
                    id: 5, 
                    customerId: 6, 
                    customerName: 'نورا حسن الغامدي', 
                    lastMessage: 'الكاميرا وصلت بحالة ممتازة! شكراً 📷', 
                    time: '13:45', 
                    unread: 0, 
                    avatar: 'ن', 
                    color: 'bg-pink-500',
                    status: 'online',
                    messages: [
                        { id: 1, text: 'مرحباً، أحتاج كاميرا احترافية للتصوير', sender: 'customer', time: '11:20', status: 'read' },
                        { id: 2, text: 'أهلاً نورا! 📸\n\nCanon EOS R5 هي الأفضل للمحترفين:\n• دقة 45 ميجابكسل\n• تصوير فيديو 8K\n• تثبيت صورة متقدم\n• عدسة RF 24-70mm مجاناً\n\n💰 السعر: 12,800 ريال\n🎁 عدسة إضافية مجاناً', sender: 'business', time: '11:22', status: 'read' },
                        { id: 3, text: 'رائع! هذا بالضبط ما أحتاجه', sender: 'customer', time: '11:25', status: 'read' },
                        { id: 4, text: '✅ طلب مؤكد #1006\n📷 Canon EOS R5 + عدسة\n💰 12,800 ريال\n📍 الطائف، حي الشفا\n🚛 تتبع: TRK789123456\n\nستصلك خلال يومين! 📦', sender: 'business', time: '11:27', status: 'read' },
                        { id: 5, text: 'الكاميرا وصلت بحالة ممتازة! شكراً 📷', sender: 'customer', time: '13:45', status: 'delivered' }
                    ]
                },
                { 
                    id: 6, 
                    customerId: 13, 
                    customerName: 'شركة الرياض للتقنية', 
                    lastMessage: 'تم استلام الشحنة كاملة، شكراً لكم', 
                    time: '11:30', 
                    unread: 0, 
                    avatar: 'ش', 
                    color: 'bg-violet-500',
                    status: 'away',
                    messages: [
                        { id: 1, text: 'نحتاج عرض سعر لـ 10 أجهزة لابتوب و 10 شاشات للمكتب الجديد', sender: 'customer', time: '09:00', status: 'read' },
                        { id: 2, text: 'أهلاً بشركة الرياض للتقنية! 💼\n\n📋 عرض سعر شامل:\n• Dell XPS 15 × 10 = 85,000 ريال\n• شاشة Samsung 4K × 10 = 22,000 ريال\n\n💰 المجموع: 107,000 ريال\n🎁 خصم الشركات: 10%\n💳 السعر النهائي: 96,300 ريال\n\n✅ ضمان 3 سنوات\n🚚 تركيب وتشغيل مجاني', sender: 'business', time: '09:15', status: 'read' },
                        { id: 3, text: 'العرض ممتاز! نوافق عليه', sender: 'customer', time: '09:30', status: 'read' },
                        { id: 4, text: '🎉 شكراً لثقتكم!\n\n✅ طلب #1013 مؤكد\n📅 التسليم: خلال 48 ساعة\n📍 الرياض، الحي المالي\n💼 سيتم التنسيق مع قسم المشتريات\n\n📋 الفاتورة: INV-2024-007', sender: 'business', time: '09:35', status: 'read' },
                        { id: 5, text: 'تم استلام الشحنة كاملة، شكراً لكم', sender: 'customer', time: '11:30', status: 'delivered' }
                    ]
                }
            ],

            // الحملات التسويقية
            campaigns: [
                { id: 1, name: 'عرض العودة للمدارس', type: 'موسمي', status: 'نشط', startDate: '2024-01-01', endDate: '2024-02-15', budget: 5000, spent: 2340, clicks: 1250, conversions: 89, targetAudience: 'طلاب وأولياء أمور', message: '🎒 عرض العودة للمدارس!\n\nخصم 25% على جميع الأجهزة التعليمية\n💻 لابتوبات وتابلت\n🎧 سماعات للدراسة\n📱 هواتف ذكية\n\n⏰ العرض ساري حتى 15 فبراير' },
                { id: 2, name: 'إطلاق منتجات جديدة', type: 'إعلاني', status: 'مكتمل', startDate: '2023-12-01', endDate: '2023-12-31', budget: 8000, spent: 7650, clicks: 2100, conversions: 156, targetAudience: 'عملاء VIP', message: '🚀 منتجات جديدة وصلت!\n\nكن أول من يحصل على:\n📱 iPhone 15 Pro Max\n⌚ Apple Watch Ultra\n🎧 AirPods Pro 2\n\n🎁 هدايا حصرية للأوائل!' },
                { id: 3, name: 'خصومات نهاية السنة', type: 'تخفيضات', status: 'مجدول', startDate: '2024-12-15', endDate: '2024-12-31', budget: 12000, spent: 0, clicks: 0, conversions: 0, targetAudience: 'جميع العملاء', message: '🎉 خصومات نهاية السنة الكبرى!\n\nخصومات تصل إلى 50%\n🛍️ على جميع المنتجات\n🎁 هدايا مجانية\n🚚 شحن مجاني\n\n⏰ لفترة محدودة فقط!' }
            ],

            // باقات الاشتراك
            subscriptionPlans: [
                {
                    id: 'free',
                    name: 'المجاني',
                    price: 0,
                    currency: 'SAR',
                    period: 'شهرياً',
                    features: [
                        'حتى 100 محادثة شهرياً',
                        'قوالب رسائل أساسية (5)',
                        'تقارير بسيطة',
                        'دعم عبر البريد الإلكتروني',
                        'تخزين 1GB'
                    ],
                    limitations: [
                        'بدون مساعد ذكي',
                        'بدون أتمتة متقدمة',
                        'بدون تقارير مفصلة',
                        'بدون دعم أولوية'
                    ]
                },
                {
                    id: 'pro',
                    name: 'الاحترافي',
                    price: 299,
                    currency: 'SAR',
                    period: 'شهرياً',
                    popular: true,
                    features: [
                        'محادثات غير محدودة',
                        'جميع قوالب الرسائل (50+)',
                        'مساعد ذكي متقدم',
                        'تقارير مفصلة وتحليلات',
                        'أتمتة الرسائل',
                        'إدارة المخزون',
                        'فواتير وعروض أسعار',
                        'حملات تسويقية',
                        'دعم أولوية 24/7',
                        'تخزين 50GB',
                        'تصدير البيانات',
                        'تكامل WhatsApp API'
                    ],
                    limitations: []
                },
                {
                    id: 'enterprise',
                    name: 'المؤسسات',
                    price: 899,
                    currency: 'SAR',
                    period: 'شهرياً',
                    features: [
                        'جميع مميزات الباقة الاحترافية',
                        'فرق عمل متعددة',
                        'أدوار وصلاحيات مخصصة',
                        'تكامل CRM متقدم',
                        'API مخصص',
                        'تدريب مخصص',
                        'مدير حساب مخصص',
                        'تخزين غير محدود',
                        'نسخ احتياطية يومية',
                        'أمان متقدم'
                    ],
                    limitations: []
                }
            ],
            
            // التحليلات المتقدمة والإحصائيات
            analytics: {
                // مبيعات يومية لآخر 30 يوم
                dailySales: [1200, 1800, 2100, 1650, 2400, 1900, 2800, 3200, 2650, 2100, 2800, 3400, 2900, 2200, 2600, 3100, 2750, 2400, 2900, 3300, 2800, 2500, 2700, 3000, 2600, 2300, 2800, 3200, 2900, 2700],
                
                // مبيعات أسبوعية لآخر 12 أسبوع
                weeklySales: [8500, 12300, 9800, 14600, 11200, 13800, 10500, 15200, 12800, 11600, 13400, 14800],
                
                // مبيعات شهرية لآخر 12 شهر
                monthlySales: [45230, 38900, 52100, 41800, 48600, 55200, 49800, 53600, 47200, 51800, 56400, 62300],
                
                // أفضل المنتجات مبيعاً
                topProducts: [
                    { name: 'هاتف iPhone 15 Pro Max', sales: 312, revenue: 1622400, growth: 15.2 },
                    { name: 'سماعات AirPods Pro 2', sales: 289, revenue: 332350, growth: 8.7 },
                    { name: 'ماوس لاسلكي Logitech MX', sales: 234, revenue: 88920, growth: 12.3 },
                    { name: 'مصباح ذكي Philips Hue', sales: 267, revenue: 48060, growth: 22.1 },
                    { name: 'مكبر صوت ذكي Amazon Echo', sales: 189, revenue: 85050, growth: 5.4 },
                    { name: 'لوحة مفاتيح ميكانيكية RGB', sales: 176, revenue: 114400, growth: -2.1 },
                    { name: 'ساعة ذكية Apple Watch Ultra', sales: 167, revenue: 534400, growth: 18.9 },
                    { name: 'سوار لياقة Fitbit', sales: 167, revenue: 113560, growth: 9.8 }
                ],
                
                // نمو العملاء (يومي لآخر 30 يوم)
                customerGrowth: [2, 3, 1, 4, 3, 5, 4, 6, 2, 3, 4, 5, 3, 2, 4, 6, 3, 4, 5, 7, 4, 3, 5, 6, 4, 2, 5, 7, 5, 4],
                
                // حالات الطلبات
                orderStatus: {
                    completed: 156,
                    pending: 23,
                    cancelled: 8,
                    processing: 15,
                    shipped: 12,
                    delivered: 144
                },
                
                // إحصائيات المحادثات
                chatStats: {
                    totalChats: 1247,
                    activeChats: 89,
                    responseTime: 2.3, // بالدقائق
                    satisfactionRate: 4.7, // من 5
                    resolvedIssues: 234,
                    pendingIssues: 12
                },
                
                // إحصائيات الحملات التسويقية
                campaignStats: {
                    totalCampaigns: 15,
                    activeCampaigns: 3,
                    totalReach: 45600,
                    totalClicks: 8950,
                    conversionRate: 12.4,
                    totalSpent: 23400,
                    roi: 340 // العائد على الاستثمار بالنسبة المئوية
                },
                
                // إحصائيات الفواتير
                invoiceStats: {
                    totalInvoices: 234,
                    paidInvoices: 198,
                    pendingInvoices: 28,
                    overdueInvoices: 8,
                    totalRevenue: 567800,
                    averageInvoiceValue: 2427
                },
                
                // أداء الأدوات
                toolsUsage: {
                    calculator: { uses: 456, satisfaction: 4.8 },
                    pdfGenerator: { uses: 234, satisfaction: 4.6 },
                    reports: { uses: 189, satisfaction: 4.7 },
                    scheduler: { uses: 167, satisfaction: 4.5 },
                    templates: { uses: 789, satisfaction: 4.9 },
                    aiAssistant: { uses: 345, satisfaction: 4.8 }
                }
            },

            // المساعد الذكي
            aiAssistant: {
                suggestions: [
                    {
                        id: 1,
                        type: 'response',
                        context: 'شكوى عميل',
                        customerMessage: 'المنتج وصل متأخر ومكسور',
                        suggestedResponse: 'نعتذر بشدة عن هذا الإزعاج 😔\n\nسنقوم فوراً بـ:\n✅ إرسال منتج بديل خلال 24 ساعة\n✅ استرداد كامل لتكلفة الشحن\n✅ خصم 20% على طلبك القادم\n\nرقم الشكوى: #CS2024001\nسنتابع معك شخصياً حتى حل المشكلة',
                        confidence: 0.92,
                        category: 'دعم فني'
                    },
                    {
                        id: 2,
                        type: 'upsell',
                        context: 'عميل اشترى لابتوب',
                        customerMessage: 'شكراً، اللابتوب ممتاز',
                        suggestedResponse: 'نسعد برضاك! 😊\n\nبما أنك أحببت اللابتوب، قد تهمك هذه الإضافات:\n🖱️ ماوس لاسلكي Logitech - 380 ريال\n⌨️ لوحة مفاتيح RGB - 650 ريال\n🖥️ شاشة 4K إضافية - 2200 ريال\n\n🎁 خصم خاص 15% عند الطلب اليوم!',
                        confidence: 0.87,
                        category: 'مبيعات'
                    },
                    {
                        id: 3,
                        type: 'follow_up',
                        context: 'عميل لم يرد منذ 3 أيام',
                        customerMessage: 'أريد عرض سعر للكاميرا',
                        suggestedResponse: 'مرحباً مرة أخرى! 📸\n\nهل ما زلت مهتماً بكاميرا Canon EOS R5؟\n\n🎯 عرض خاص لك:\n💰 السعر: 12,800 ريال\n🎁 عدسة إضافية مجاناً (قيمة 2000 ريال)\n📦 شحن مجاني وتسليم خلال 24 ساعة\n\n⏰ العرض ساري لمدة 48 ساعة فقط!',
                        confidence: 0.89,
                        category: 'متابعة'
                    }
                ],
                
                insights: [
                    {
                        type: 'trend',
                        title: 'ارتفاع الطلب على المنتجات الذكية',
                        description: 'زيادة 35% في مبيعات المنتجات الذكية هذا الشهر',
                        recommendation: 'زيادة المخزون من المنتجات الذكية وإطلاق حملة تسويقية مخصصة',
                        priority: 'عالية'
                    },
                    {
                        type: 'customer',
                        title: 'عملاء VIP يحتاجون اهتمام خاص',
                        description: '15 عميل VIP لم يتم التواصل معهم منذ أسبوعين',
                        recommendation: 'إرسال رسائل شخصية وعروض حصرية للعملاء VIP',
                        priority: 'متوسطة'
                    },
                    {
                        type: 'inventory',
                        title: 'نفاد مخزون منتجات شائعة',
                        description: '5 منتجات على وشك النفاد من المخزون',
                        recommendation: 'طلب مخزون إضافي فوراً لتجنب فقدان المبيعات',
                        priority: 'عالية'
                    }
                ]
            },

            // إعدادات الإشعارات المتقدمة
            notifications: [
                { id: 1, type: 'order', title: 'طلب جديد #1016', message: 'طلب جديد من عبدالرحمن السعيد بقيمة 2,400 ريال', time: '5 دقائق', read: false, priority: 'high' },
                { id: 2, type: 'payment', title: 'دفعة مستلمة', message: 'تم استلام دفعة 8,500 ريال من محمد الراشد', time: '15 دقيقة', read: false, priority: 'medium' },
                { id: 3, type: 'inventory', title: 'تنبيه مخزون', message: 'مخزون iPhone 15 Pro Max أقل من 10 قطع', time: '30 دقيقة', read: true, priority: 'high' },
                { id: 4, type: 'customer', title: 'عميل VIP جديد', message: 'سارة الأحمد أصبحت عميلة VIP بعد تجاوز 50,000 ريال', time: '1 ساعة', read: true, priority: 'low' },
                { id: 5, type: 'campaign', title: 'نتائج الحملة', message: 'حملة "العودة للمدارس" حققت 89 تحويل جديد', time: '2 ساعة', read: true, priority: 'medium' }
            ]
        };

        // متغيرات النظام المتقدمة
        let currentUser = {
            id: 1,
            name: 'مشاري أحمد',
            email: 'mishari@business.com',
            role: 'مدير',
            avatar: 'م',
            permissions: ['all'],
            lastLogin: '2024-01-15 14:30',
            subscription: 'free'
        };

        function startApp() {
            businessName = document.getElementById('businessName').value || 'مشاري بزنس';
            currentCurrency = document.getElementById('currency').value;
            
            document.getElementById('businessTitle').textContent = businessName;
            document.getElementById('businessNameInput').value = businessName;
            document.getElementById('currencySelect').value = currentCurrency;
            
            document.getElementById('onboarding').classList.add('hidden');
            document.getElementById('mainApp').classList.remove('hidden');
            
            // تحميل البيانات
            loadChats();
            loadDashboardData();
            
            // إنشاء الرسوم البيانية
            setTimeout(createCharts, 500);
        }

        function loadChats() {
            const chatsList = document.getElementById('chatsList-content');
            chatsList.innerHTML = '';
            
            database.chats.forEach(chat => {
                const chatItem = document.createElement('div');
                chatItem.className = 'chat-item p-3 md:p-4 border-b border-gray-100 cursor-pointer hover:bg-gray-50';
                chatItem.onclick = () => selectChat(chat.customerName, chat.id);
                
                chatItem.innerHTML = `
                    <div class="flex items-center space-x-3 space-x-reverse">
                        <div class="w-10 h-10 md:w-12 md:h-12 ${chat.color} rounded-full flex items-center justify-center text-white font-semibold text-sm md:text-base">
                            ${chat.avatar}
                        </div>
                        <div class="flex-1 min-w-0">
                            <h3 class="font-semibold text-gray-900 text-sm md:text-base truncate">${chat.customerName}</h3>
                            <p class="text-xs md:text-sm text-gray-600 truncate">${chat.lastMessage}</p>
                        </div>
                        <div class="text-left flex-shrink-0">
                            <p class="text-xs text-gray-500">${chat.time}</p>
                            ${chat.unread > 0 ? `<span class="bg-emerald-500 text-white text-xs rounded-full px-2 py-1 mt-1 inline-block">${chat.unread}</span>` : ''}
                        </div>
                    </div>
                `;
                
                chatsList.appendChild(chatItem);
            });
        }

        function loadDashboardData() {
            // تحديث الإحصائيات من قاعدة البيانات
            const totalSales = database.orders.reduce((sum, order) => sum + order.total, 0);
            const totalOrders = database.orders.length;
            const avgOrder = totalOrders > 0 ? Math.round(totalSales / totalOrders) : 0;
            const newCustomers = database.customers.filter(c => c.status === 'جديد').length;
            
            // سيتم استخدام هذه البيانات في لوحة التحكم
        }

        function toggleTheme() {
            isDarkMode = !isDarkMode;
            document.body.classList.toggle('dark', isDarkMode);
            document.getElementById('themeIcon').textContent = isDarkMode ? '☀️' : '🌙';
        }

        function toggleSidebar() {
            // يمكن إضافة وظائف الإعدادات هنا
            alert('قريباً: إعدادات متقدمة');
        }

        function toggleToolsPanel() {
            const panel = document.getElementById('toolsPanel');
            panel.classList.toggle('translate-x-full');
        }

        function toggleMobileMenu() {
            const chatsList = document.getElementById('chatsList');
            chatsList.classList.toggle('-translate-x-full');
        }

        function selectChat(chatName, chatId) {
            document.getElementById('currentChatName').textContent = chatName;
            document.getElementById('chatStatus').textContent = 'متصل الآن';
            
            // إخفاء قائمة المحادثات على الجوال بعد الاختيار
            if (window.innerWidth < 768) {
                document.getElementById('chatsList').classList.add('-translate-x-full');
            }
            
            // تحديث الرسائل حسب المحادثة المختارة
            updateChatMessages(chatId);
        }

        function updateChatMessages(chatId) {
            const messagesArea = document.getElementById('messagesArea');
            const chat = database.chats.find(c => c.id === chatId);
            
            if (chat && chat.messages) {
                messagesArea.innerHTML = '';
                
                chat.messages.forEach(message => {
                    const messageDiv = document.createElement('div');
                    messageDiv.className = `flex ${message.sender === 'business' ? 'justify-end' : 'justify-start'}`;
                    
                    messageDiv.innerHTML = `
                        <div class="${message.sender === 'business' ? 'chat-bubble-sent' : 'chat-bubble-received'} max-w-xs md:max-w-sm px-3 py-2 md:px-4 md:py-2">
                            <p class="text-sm md:text-base">${message.text}</p>
                            <p class="text-xs ${message.sender === 'business' ? 'text-white/70' : 'text-gray-500'} mt-1">
                                ${message.time} ${message.sender === 'business' ? '✓✓' : ''}
                            </p>
                        </div>
                    `;
                    
                    messagesArea.appendChild(messageDiv);
                });
                
                messagesArea.scrollTop = messagesArea.scrollHeight;
            }
        }

        // وظائف الإعدادات
        function showSettings() {
            document.getElementById('settings').classList.remove('hidden');
        }

        function hideSettings() {
            document.getElementById('settings').classList.add('hidden');
        }

        function showSettingsTab(tabName) {
            // إخفاء جميع المحتويات
            document.querySelectorAll('.settings-content').forEach(content => {
                content.classList.add('hidden');
            });
            
            // إظهار المحتوى المحدد
            document.getElementById(tabName + '-settings').classList.remove('hidden');
            
            // تحديث التبويبات
            document.querySelectorAll('.settings-tab').forEach(tab => {
                tab.classList.remove('bg-emerald-100', 'text-emerald-700', 'border-b-2', 'border-emerald-500');
                tab.classList.add('text-gray-600', 'hover:bg-gray-100');
            });
            
            event.target.classList.add('bg-emerald-100', 'text-emerald-700', 'border-b-2', 'border-emerald-500');
            event.target.classList.remove('text-gray-600', 'hover:bg-gray-100');
        }

        function toggleNotifications() {
            notifications = !notifications;
            const toggle = document.getElementById('notificationsToggle');
            const slider = document.getElementById('notificationsSlider');
            
            if (notifications) {
                toggle.classList.add('bg-emerald-500');
                toggle.classList.remove('bg-gray-200');
                slider.classList.add('translate-x-6');
                slider.classList.remove('translate-x-1');
            } else {
                toggle.classList.remove('bg-emerald-500');
                toggle.classList.add('bg-gray-200');
                slider.classList.remove('translate-x-6');
                slider.classList.add('translate-x-1');
            }
        }

        function toggleAutoReply() {
            autoReply = !autoReply;
            const toggle = document.getElementById('autoReplyToggle');
            const slider = document.getElementById('autoReplySlider');
            const settings = document.getElementById('autoReplySettings');
            
            if (autoReply) {
                toggle.classList.add('bg-emerald-500');
                toggle.classList.remove('bg-gray-200');
                slider.classList.add('translate-x-6');
                slider.classList.remove('translate-x-1');
                settings.classList.remove('hidden');
            } else {
                toggle.classList.remove('bg-emerald-500');
                toggle.classList.add('bg-gray-200');
                slider.classList.remove('translate-x-6');
                slider.classList.add('translate-x-1');
                settings.classList.add('hidden');
            }
        }

        function saveSettings() {
            // حفظ الإعدادات
            businessName = document.getElementById('businessNameInput').value;
            currentCurrency = document.getElementById('currencySelect').value;
            currentLanguage = document.getElementById('languageSelect').value;
            
            // تحديث العنوان
            document.getElementById('businessTitle').textContent = businessName;
            
            alert('تم حفظ الإعدادات بنجاح!');
            hideSettings();
        }

        // وظائف التصدير
        function exportChats() {
            const data = JSON.stringify(database.chats, null, 2);
            downloadFile(data, 'chats.json', 'application/json');
            alert('تم تصدير المحادثات بنجاح!');
        }

        function exportOrders() {
            const data = JSON.stringify(database.orders, null, 2);
            downloadFile(data, 'orders.json', 'application/json');
            alert('تم تصدير الطلبات بنجاح!');
        }

        function exportCustomers() {
            const data = JSON.stringify(database.customers, null, 2);
            downloadFile(data, 'customers.json', 'application/json');
            alert('تم تصدير العملاء بنجاح!');
        }

        function exportReports() {
            const data = JSON.stringify(database.analytics, null, 2);
            downloadFile(data, 'reports.json', 'application/json');
            alert('تم تصدير التقارير بنجاح!');
        }

        function createBackup() {
            const data = JSON.stringify(database, null, 2);
            downloadFile(data, 'backup.json', 'application/json');
            alert('تم إنشاء النسخة الاحتياطية بنجاح!');
        }

        function downloadFile(data, filename, type) {
            const blob = new Blob([data], { type: type });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }

        function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            
            if (message) {
                addMessage(message, true);
                input.value = '';
                
                // محاكاة رد تلقائي
                setTimeout(() => {
                    showTypingIndicator();
                    setTimeout(() => {
                        hideTypingIndicator();
                        addMessage('شكراً لك! سأتابع الأمر', false);
                    }, 2000);
                }, 1000);
            }
        }

        function addMessage(text, isSent) {
            const messagesArea = document.getElementById('messagesArea');
            const messageDiv = document.createElement('div');
            messageDiv.className = `flex ${isSent ? 'justify-end' : 'justify-start'}`;
            
            const time = new Date().toLocaleTimeString('ar-SA', { 
                hour: '2-digit', 
                minute: '2-digit' 
            });
            
            messageDiv.innerHTML = `
                <div class="${isSent ? 'chat-bubble-sent' : 'chat-bubble-received'} max-w-xs px-4 py-2">
                    <p>${text}</p>
                    <p class="text-xs ${isSent ? 'text-white/70' : 'text-gray-500'} mt-1">
                        ${time} ${isSent ? '✓✓' : ''}
                    </p>
                </div>
            `;
            
            messagesArea.appendChild(messageDiv);
            messagesArea.scrollTop = messagesArea.scrollHeight;
        }

        function showTypingIndicator() {
            document.getElementById('typingIndicator').classList.remove('hidden');
            document.getElementById('messagesArea').scrollTop = document.getElementById('messagesArea').scrollHeight;
        }

        function hideTypingIndicator() {
            document.getElementById('typingIndicator').classList.add('hidden');
        }

        function handleEnter(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        function showTool(toolName) {
            // إخفاء جميع الأدوات
            document.querySelectorAll('.tool-content').forEach(tool => {
                tool.classList.add('hidden');
            });
            
            // إظهار الأداة المحددة
            document.getElementById(toolName + '-tool').classList.remove('hidden');
            
            // تحديث التبويبات
            document.querySelectorAll('.tool-tab').forEach(tab => {
                tab.classList.remove('bg-emerald-100', 'text-emerald-700');
                tab.classList.add('text-gray-600', 'hover:bg-gray-100');
            });
            
            event.target.classList.add('bg-emerald-100', 'text-emerald-700');
            event.target.classList.remove('text-gray-600', 'hover:bg-gray-100');
        }

        // إضافة مستمع للنقر خارج اللوحات لإغلاقها على الجوال
        document.addEventListener('click', function(event) {
            const toolsPanel = document.getElementById('toolsPanel');
            const chatsList = document.getElementById('chatsList');
            
            // إغلاق لوحة الأدوات إذا تم النقر خارجها على الجوال
            if (window.innerWidth < 768 && !toolsPanel.contains(event.target) && 
                !event.target.closest('button[onclick="toggleToolsPanel()"]')) {
                toolsPanel.classList.add('translate-x-full');
            }
            
            // إغلاق قائمة المحادثات إذا تم النقر خارجها على الجوال
            if (window.innerWidth < 768 && !chatsList.contains(event.target) && 
                !event.target.closest('button[onclick="toggleMobileMenu()"]')) {
                chatsList.classList.add('-translate-x-full');
            }
        });

        // متغيرات إضافية للأدوات المتقدمة
        let selectedTemplate = null;
        let selectedProducts = [];
        let aiEnabled = true;
        let currentPlan = 'free';

        function calculateProfit() {
            const sales = parseFloat(document.getElementById('sales').value) || 0;
            const costs = parseFloat(document.getElementById('costs').value) || 0;
            const operatingCosts = parseFloat(document.getElementById('operatingCosts').value) || 0;
            const taxRate = parseFloat(document.getElementById('taxes').value) || 0;
            
            const grossProfit = sales - costs;
            const operatingProfit = grossProfit - operatingCosts;
            const taxes = operatingProfit * (taxRate / 100);
            const netProfit = operatingProfit - taxes;
            const profitMargin = sales > 0 ? (netProfit / sales * 100).toFixed(1) : 0;
            const roi = costs > 0 ? (netProfit / costs * 100).toFixed(1) : 0;
            
            document.getElementById('grossProfit').textContent = `${grossProfit.toLocaleString()} ${getCurrencySymbol()}`;
            document.getElementById('operatingProfit').textContent = `${operatingProfit.toLocaleString()} ${getCurrencySymbol()}`;
            document.getElementById('netProfit').textContent = `${netProfit.toLocaleString()} ${getCurrencySymbol()}`;
            document.getElementById('profitMargin').textContent = `${profitMargin}%`;
            document.getElementById('roi').textContent = `${roi}%`;
            
            document.getElementById('profitResults').classList.remove('hidden');
        }

        function sendProfitSummary() {
            const sales = parseFloat(document.getElementById('sales').value) || 0;
            const netProfit = parseFloat(document.getElementById('netProfit').textContent.replace(/[^\d.-]/g, '')) || 0;
            const profitMargin = document.getElementById('profitMargin').textContent;
            
            const summary = `📊 ملخص تحليل الأرباح\n\n💰 إجمالي المبيعات: ${sales.toLocaleString()} ${getCurrencySymbol()}\n💵 صافي الربح: ${netProfit.toLocaleString()} ${getCurrencySymbol()}\n📈 هامش الربح: ${profitMargin}\n\n✅ تم إنشاء التحليل بواسطة حاسبة الأرباح المتقدمة`;
            
            addMessage(summary, true);
            alert('تم إرسال ملخص الأرباح في المحادثة!');
        }

        // وظائف القوالب
        function loadTemplates() {
            const templatesList = document.getElementById('templatesList');
            const category = document.getElementById('templateCategory').value;
            
            let filteredTemplates = database.templates;
            if (category) {
                filteredTemplates = database.templates.filter(t => t.category === category);
            }
            
            templatesList.innerHTML = '';
            filteredTemplates.forEach(template => {
                const templateItem = document.createElement('div');
                templateItem.className = 'p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50';
                templateItem.onclick = () => selectTemplate(template);
                
                templateItem.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div>
                            <h5 class="font-medium text-gray-900 text-sm">${template.name}</h5>
                            <p class="text-xs text-gray-600">${template.category}</p>
                        </div>
                        <span class="text-xs text-gray-500">${template.usage} استخدام</span>
                    </div>
                `;
                
                templatesList.appendChild(templateItem);
            });
        }

        function filterTemplates() {
            loadTemplates();
        }

        function selectTemplate(template) {
            selectedTemplate = template;
            document.getElementById('templatePreview').innerHTML = `
                <div class="space-y-2">
                    <h5 class="font-medium text-gray-900">${template.name}</h5>
                    <p class="text-sm text-gray-600 whitespace-pre-line">${template.content}</p>
                    ${template.variables.length > 0 ? `<p class="text-xs text-blue-600">المتغيرات: ${template.variables.join(', ')}</p>` : ''}
                </div>
            `;
            document.getElementById('useTemplateBtn').disabled = false;
        }

        function useTemplate() {
            if (!selectedTemplate) return;
            
            let content = selectedTemplate.content;
            
            // استبدال المتغيرات بقيم افتراضية
            content = content.replace(/{name}/g, 'العميل الكريم');
            content = content.replace(/{business_name}/g, businessName);
            content = content.replace(/{currency}/g, getCurrencySymbol());
            content = content.replace(/{date}/g, new Date().toLocaleDateString('ar-SA'));
            
            document.getElementById('messageInput').value = content;
            alert('تم إدراج القالب! يمكنك تعديله قبل الإرسال.');
        }

        // وظائف المساعد الذكي
        function loadAISuggestions() {
            const suggestionsContainer = document.getElementById('aiSuggestions');
            const insightsContainer = document.getElementById('aiInsights');
            
            if (currentPlan === 'free') {
                suggestionsContainer.innerHTML = `
                    <div class="text-center p-4 bg-yellow-50 rounded-lg">
                        <p class="text-sm text-yellow-800 mb-2">🔒 المساعد الذكي متاح في الباقة الاحترافية</p>
                        <button onclick="showSubscription()" class="text-xs bg-emerald-500 text-white px-3 py-1 rounded-lg hover:bg-emerald-600">
                            ترقية الآن
                        </button>
                    </div>
                `;
                insightsContainer.innerHTML = `
                    <div class="text-center p-3 bg-yellow-50 rounded-lg">
                        <p class="text-xs text-yellow-800">الرؤى الذكية متاحة في الباقة الاحترافية</p>
                    </div>
                `;
                return;
            }
            
            // عرض الاقتراحات
            suggestionsContainer.innerHTML = '';
            database.aiAssistant.suggestions.forEach(suggestion => {
                const suggestionDiv = document.createElement('div');
                suggestionDiv.className = 'p-3 bg-white border border-blue-200 rounded-lg cursor-pointer hover:bg-blue-50';
                suggestionDiv.onclick = () => useSuggestion(suggestion);
                
                suggestionDiv.innerHTML = `
                    <div class="flex justify-between items-start mb-2">
                        <span class="text-xs font-medium text-blue-700">${suggestion.category}</span>
                        <span class="text-xs text-gray-500">${Math.round(suggestion.confidence * 100)}%</span>
                    </div>
                    <p class="text-sm text-gray-700">${suggestion.suggestedResponse.substring(0, 100)}...</p>
                `;
                
                suggestionsContainer.appendChild(suggestionDiv);
            });
            
            // عرض الرؤى
            insightsContainer.innerHTML = '';
            database.aiAssistant.insights.forEach(insight => {
                const insightDiv = document.createElement('div');
                insightDiv.className = `p-3 border-l-4 ${insight.priority === 'عالية' ? 'border-red-400 bg-red-50' : insight.priority === 'متوسطة' ? 'border-yellow-400 bg-yellow-50' : 'border-blue-400 bg-blue-50'} rounded`;
                
                insightDiv.innerHTML = `
                    <h6 class="text-sm font-medium text-gray-900">${insight.title}</h6>
                    <p class="text-xs text-gray-600 mt-1">${insight.description}</p>
                    <p class="text-xs text-gray-500 mt-2">💡 ${insight.recommendation}</p>
                `;
                
                insightsContainer.appendChild(insightDiv);
            });
        }

        function useSuggestion(suggestion) {
            document.getElementById('messageInput').value = suggestion.suggestedResponse;
            alert('تم إدراج الاقتراح! يمكنك تعديله قبل الإرسال.');
        }

        function toggleAI() {
            aiEnabled = !aiEnabled;
            const toggle = document.getElementById('aiToggle');
            const slider = document.getElementById('aiSlider');
            
            if (aiEnabled) {
                toggle.classList.add('bg-emerald-500');
                toggle.classList.remove('bg-gray-200');
                slider.classList.add('translate-x-6');
                slider.classList.remove('translate-x-1');
            } else {
                toggle.classList.remove('bg-emerald-500');
                toggle.classList.add('bg-gray-200');
                slider.classList.remove('translate-x-6');
                slider.classList.add('translate-x-1');
            }
        }

        // وظائف الكتالوج
        function loadProducts() {
            const productsList = document.getElementById('productsList');
            const searchTerm = document.getElementById('productSearch').value.toLowerCase();
            const category = document.getElementById('categoryFilter').value;
            
            let filteredProducts = database.products;
            
            if (searchTerm) {
                filteredProducts = filteredProducts.filter(p => 
                    p.name.toLowerCase().includes(searchTerm) || 
                    p.description.toLowerCase().includes(searchTerm)
                );
            }
            
            if (category) {
                filteredProducts = filteredProducts.filter(p => p.category === category);
            }
            
            productsList.innerHTML = '';
            filteredProducts.forEach(product => {
                const productItem = document.createElement('div');
                productItem.className = 'p-3 border border-gray-200 rounded-lg hover:bg-gray-50';
                
                productItem.innerHTML = `
                    <div class="flex items-center space-x-3 space-x-reverse">
                        <div class="text-2xl">${product.image}</div>
                        <div class="flex-1 min-w-0">
                            <h5 class="font-medium text-gray-900 text-sm truncate">${product.name}</h5>
                            <p class="text-xs text-gray-600">${product.category}</p>
                            <div class="flex items-center justify-between mt-1">
                                <span class="text-sm font-bold text-emerald-600">${product.price.toLocaleString()} ${getCurrencySymbol()}</span>
                                <span class="text-xs text-gray-500">مخزون: ${product.stock}</span>
                            </div>
                        </div>
                        <button onclick="toggleProductSelection(${product.id})" class="text-emerald-600 hover:text-emerald-700 text-sm">
                            ${selectedProducts.includes(product.id) ? '✓' : '+'}
                        </button>
                    </div>
                `;
                
                productsList.appendChild(productItem);
            });
        }

        function searchProducts() {
            loadProducts();
        }

        function filterProducts() {
            loadProducts();
        }

        function toggleProductSelection(productId) {
            const index = selectedProducts.indexOf(productId);
            if (index > -1) {
                selectedProducts.splice(index, 1);
            } else {
                selectedProducts.push(productId);
            }
            
            updateSelectedProducts();
            loadProducts(); // إعادة تحميل لتحديث الأيقونات
        }

        function updateSelectedProducts() {
            const container = document.getElementById('selectedProducts');
            const button = document.getElementById('sendProductsBtn');
            
            if (selectedProducts.length === 0) {
                container.innerHTML = '<p class="text-sm text-gray-500">لم يتم تحديد منتجات</p>';
                button.disabled = true;
                return;
            }
            
            container.innerHTML = '';
            selectedProducts.forEach(productId => {
                const product = database.products.find(p => p.id === productId);
                if (product) {
                    const productDiv = document.createElement('div');
                    productDiv.className = 'flex items-center justify-between p-2 bg-emerald-50 rounded-lg';
                    productDiv.innerHTML = `
                        <div class="flex items-center space-x-2 space-x-reverse">
                            <span>${product.image}</span>
                            <div>
                                <p class="text-sm font-medium">${product.name}</p>
                                <p class="text-xs text-gray-600">${product.price.toLocaleString()} ${getCurrencySymbol()}</p>
                            </div>
                        </div>
                        <button onclick="toggleProductSelection(${product.id})" class="text-red-500 hover:text-red-700 text-sm">✕</button>
                    `;
                    container.appendChild(productDiv);
                }
            });
            
            button.disabled = false;
        }

        function sendSelectedProducts() {
            if (selectedProducts.length === 0) return;
            
            let message = '🛍️ كتالوج المنتجات المختارة:\n\n';
            let total = 0;
            
            selectedProducts.forEach(productId => {
                const product = database.products.find(p => p.id === productId);
                if (product) {
                    message += `${product.image} ${product.name}\n💰 ${product.price.toLocaleString()} ${getCurrencySymbol()}\n📦 متوفر: ${product.stock} قطعة\n⭐ تقييم: ${product.rating}/5\n\n`;
                    total += product.price;
                }
            });
            
            message += `💳 إجمالي المنتجات المختارة: ${total.toLocaleString()} ${getCurrencySymbol()}\n\n🚚 شحن مجاني للطلبات أكثر من 500 ريال\n📞 للطلب تواصل معنا مباشرة`;
            
            addMessage(message, true);
            
            // إعادة تعيين التحديد
            selectedProducts = [];
            updateSelectedProducts();
            loadProducts();
            
            alert('تم إرسال المنتجات المختارة في المحادثة!');
        }

        // وظائف الاشتراكات
        function showSubscription() {
            document.getElementById('subscription').classList.remove('hidden');
        }

        function hideSubscription() {
            document.getElementById('subscription').classList.add('hidden');
        }

        function showUpgradeModal(plan) {
            document.getElementById('upgradeModal').classList.remove('hidden');
        }

        function hideUpgradeModal() {
            document.getElementById('upgradeModal').classList.add('hidden');
        }

        function processUpgrade() {
            // محاكاة عملية الترقية
            setTimeout(() => {
                currentPlan = 'pro';
                currentUser.subscription = 'pro';
                
                hideUpgradeModal();
                hideSubscription();
                
                // تحديث الواجهة
                document.querySelector('.bg-blue-50').innerHTML = `
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="text-lg font-semibold text-emerald-900">اشتراكك الحالي</h3>
                            <p class="text-emerald-700">الباقة الاحترافية 🎉</p>
                            <p class="text-sm text-emerald-600 mt-1">محادثات غير محدودة + جميع المميزات</p>
                        </div>
                        <div class="text-left">
                            <p class="text-2xl font-bold text-emerald-900">299 ريال</p>
                            <p class="text-sm text-emerald-600">شهرياً</p>
                        </div>
                    </div>
                `;
                
                alert('🎉 تهانينا! تم ترقية حسابك للباقة الاحترافية بنجاح!\n\nيمكنك الآن الاستفادة من جميع المميزات المتقدمة.');
                
                // تحديث المساعد الذكي
                loadAISuggestions();
            }, 2000);
            
            // عرض رسالة التحميل
            document.querySelector('#upgradeModal .bg-white').innerHTML = `
                <div class="text-center py-8">
                    <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-emerald-500 mx-auto mb-4"></div>
                    <h3 class="text-lg font-semibold text-gray-900 mb-2">جاري معالجة الترقية...</h3>
                    <p class="text-gray-600">يرجى الانتظار</p>
                </div>
            `;
        }

        function getCurrencySymbol() {
            const symbols = {
                'SAR': 'ريال',
                'AED': 'درهم',
                'USD': 'دولار'
            };
            return symbols[currentCurrency] || 'ريال';
        }

        function handleImageUpload(event) {
            selectedImages = Array.from(event.target.files);
            
            if (selectedImages.length > 0) {
                document.getElementById('imagePreview').classList.remove('hidden');
                const imageList = document.getElementById('imageList');
                imageList.innerHTML = '';
                
                selectedImages.forEach((file, index) => {
                    const div = document.createElement('div');
                    div.className = 'flex items-center justify-between bg-gray-50 p-2 rounded';
                    div.innerHTML = `
                        <span class="text-sm text-gray-700">${file.name}</span>
                        <button onclick="removeImage(${index})" class="text-red-500 hover:text-red-700">✕</button>
                    `;
                    imageList.appendChild(div);
                });
            }
        }

        function removeImage(index) {
            selectedImages.splice(index, 1);
            if (selectedImages.length === 0) {
                document.getElementById('imagePreview').classList.add('hidden');
            } else {
                // إعادة عرض القائمة
                handleImageUpload({ target: { files: selectedImages } });
            }
        }

        function convertToPDF() {
            if (selectedImages.length === 0) {
                alert('يرجى اختيار صور أولاً');
                return;
            }
            
            // محاكاة تحويل PDF
            alert(`تم تحويل ${selectedImages.length} صورة إلى PDF بنجاح!`);
            
            // إضافة رسالة في الشات
            addMessage(`تم إنشاء ملف PDF يحتوي على ${selectedImages.length} صفحة وإرساله للعميل`, true);
            
            // إعادة تعيين
            selectedImages = [];
            document.getElementById('imagePreview').classList.add('hidden');
            document.getElementById('imageInput').value = '';
        }

        function generateReport() {
            alert('تم تصدير التقرير بنجاح!');
            addMessage('تم إنشاء تقرير المبيعات الشهري وإرساله', true);
        }

        function scheduleMessage() {
            const message = document.getElementById('scheduledMessage').value;
            const dateTime = document.getElementById('scheduleDateTime').value;
            const repeat = document.getElementById('scheduleRepeat').value;
            
            if (!message || !dateTime) {
                alert('يرجى ملء جميع الحقول');
                return;
            }
            
            const scheduledItem = {
                id: Date.now(),
                message,
                dateTime,
                repeat,
                status: 'scheduled'
            };
            
            scheduledMessages.push(scheduledItem);
            updateScheduledList();
            
            // إعادة تعيين النموذج
            document.getElementById('scheduledMessage').value = '';
            document.getElementById('scheduleDateTime').value = '';
            document.getElementById('scheduleRepeat').value = 'none';
            
            alert('تم جدولة الرسالة بنجاح!');
        }

        function updateScheduledList() {
            const list = document.getElementById('scheduledList');
            
            if (scheduledMessages.length === 0) {
                list.innerHTML = `
                    <h4 class="font-medium text-gray-700">الرسائل المجدولة:</h4>
                    <div class="text-sm text-gray-500">لا توجد رسائل مجدولة</div>
                `;
                return;
            }
            
            let html = '<h4 class="font-medium text-gray-700">الرسائل المجدولة:</h4>';
            
            scheduledMessages.forEach(item => {
                const date = new Date(item.dateTime).toLocaleString('ar-SA');
                html += `
                    <div class="bg-gray-50 p-3 rounded-lg">
                        <p class="text-sm font-medium text-gray-900">${item.message.substring(0, 50)}...</p>
                        <p class="text-xs text-gray-600">موعد الإرسال: ${date}</p>
                        <p class="text-xs text-gray-600">التكرار: ${getRepeatText(item.repeat)}</p>
                        <button onclick="cancelScheduled(${item.id})" class="text-xs text-red-500 hover:text-red-700 mt-1">
                            إلغاء
                        </button>
                    </div>
                `;
            });
            
            list.innerHTML = html;
        }

        function getRepeatText(repeat) {
            const texts = {
                'none': 'بدون تكرار',
                'daily': 'يومياً',
                'weekly': 'أسبوعياً',
                'monthly': 'شهرياً'
            };
            return texts[repeat] || 'بدون تكرار';
        }

        function cancelScheduled(id) {
            scheduledMessages = scheduledMessages.filter(item => item.id !== id);
            updateScheduledList();
        }

        function showDashboard() {
            document.getElementById('dashboard').classList.remove('hidden');
            updateDashboardStats();
            updateRecentOrders();
            setTimeout(createDashboardChart, 100);
        }

        function updateDashboardStats() {
            const totalSales = database.orders.reduce((sum, order) => sum + order.total, 0);
            const totalOrders = database.orders.length;
            const avgOrder = totalOrders > 0 ? Math.round(totalSales / totalOrders) : 0;
            const newCustomers = database.customers.filter(c => c.status === 'جديد').length;
            
            const statsContainer = document.getElementById('dashboardStats');
            statsContainer.innerHTML = `
                <div class="bg-gradient-to-r from-emerald-500 to-emerald-600 p-4 md:p-6 rounded-xl text-white">
                    <h3 class="text-sm md:text-lg font-semibold mb-2">إجمالي المبيعات</h3>
                    <p class="text-xl md:text-3xl font-bold">${totalSales.toLocaleString()} ${getCurrencySymbol()}</p>
                    <p class="text-emerald-100 text-xs md:text-sm">+12% من الشهر الماضي</p>
                </div>
                
                <div class="bg-gradient-to-r from-blue-500 to-blue-600 p-4 md:p-6 rounded-xl text-white">
                    <h3 class="text-sm md:text-lg font-semibold mb-2">عدد الطلبات</h3>
                    <p class="text-xl md:text-3xl font-bold">${totalOrders}</p>
                    <p class="text-blue-100 text-xs md:text-sm">+8% من الشهر الماضي</p>
                </div>
                
                <div class="bg-gradient-to-r from-purple-500 to-purple-600 p-4 md:p-6 rounded-xl text-white">
                    <h3 class="text-sm md:text-lg font-semibold mb-2">متوسط الطلب</h3>
                    <p class="text-xl md:text-3xl font-bold">${avgOrder} ${getCurrencySymbol()}</p>
                    <p class="text-purple-100 text-xs md:text-sm">+5% من الشهر الماضي</p>
                </div>
                
                <div class="bg-gradient-to-r from-orange-500 to-orange-600 p-4 md:p-6 rounded-xl text-white">
                    <h3 class="text-sm md:text-lg font-semibold mb-2">العملاء الجدد</h3>
                    <p class="text-xl md:text-3xl font-bold">${newCustomers}</p>
                    <p class="text-orange-100 text-xs md:text-sm">+15% من الشهر الماضي</p>
                </div>
            `;
        }

        function updateRecentOrders() {
            const recentOrders = database.orders.slice(-5).reverse();
            const ordersContainer = document.getElementById('recentOrders');
            
            ordersContainer.innerHTML = recentOrders.map(order => {
                const statusColors = {
                    'مكتمل': 'bg-green-100 text-green-800',
                    'قيد التنفيذ': 'bg-yellow-100 text-yellow-800',
                    'جديد': 'bg-blue-100 text-blue-800',
                    'ملغي': 'bg-red-100 text-red-800'
                };
                
                return `
                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                        <div>
                            <p class="font-medium text-gray-900">طلب #${order.id}</p>
                            <p class="text-sm text-gray-600">${order.customerName} - ${order.total} ${getCurrencySymbol()}</p>
                        </div>
                        <span class="${statusColors[order.status] || 'bg-gray-100 text-gray-800'} px-2 py-1 rounded-full text-xs">${order.status}</span>
                    </div>
                `;
            }).join('');
        }

        function hideDashboard() {
            document.getElementById('dashboard').classList.add('hidden');
        }

        function createCharts() {
            // رسم بياني للتقارير
            const ctx = document.getElementById('salesChart');
            if (ctx) {
                new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: ['يناير', 'فبراير', 'مارس', 'أبريل', 'مايو', 'يونيو'],
                        datasets: [{
                            label: 'المبيعات',
                            data: database.analytics.monthlySales.slice(0, 6),
                            borderColor: '#10B981',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
            }
        }

        function createDashboardChart() {
            const ctx = document.getElementById('dashboardChart');
            if (ctx) {
                new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: ['الأسبوع 1', 'الأسبوع 2', 'الأسبوع 3', 'الأسبوع 4'],
                        datasets: [{
                            label: 'المبيعات الأسبوعية',
                            data: database.analytics.weeklySales,
                            backgroundColor: 'rgba(16, 185, 129, 0.8)',
                            borderColor: '#10B981',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
            }
        }

        // تهيئة التطبيق
        document.addEventListener('DOMContentLoaded', function() {
            // تعيين التاريخ الافتراضي للجدولة
            const now = new Date();
            now.setHours(now.getHours() + 1);
            document.getElementById('scheduleDateTime').value = now.toISOString().slice(0, 16);
            
            // تحميل البيانات الأولية للأدوات
            loadTemplates();
            loadProducts();
            loadAISuggestions();
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'970287fce5e1ce0c',t:'MTc1NTM2NDA4MC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
